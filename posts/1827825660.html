<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>ESP32使用SPI总线驱动LCD | 赵逸尘个人博客</title><meta name="keywords" content="Ubuntu,LCD,ST7789,ESP32,乐鑫,SDK-IDF,液晶屏"><meta name="author" content="ZhaoYichen"><meta name="copyright" content="ZhaoYichen"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="ESP32使用SPI总线驱动LCD液晶屏">
<meta property="og:type" content="article">
<meta property="og:title" content="ESP32使用SPI总线驱动LCD">
<meta property="og:url" content="https://zml3589110.github.io/posts/1827825660.html">
<meta property="og:site_name" content="赵逸尘个人博客">
<meta property="og:description" content="ESP32使用SPI总线驱动LCD液晶屏">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg">
<meta property="article:published_time" content="2024-07-18T02:34:20.000Z">
<meta property="article:modified_time" content="2024-07-18T02:52:58.853Z">
<meta property="article:author" content="ZhaoYichen">
<meta property="article:tag" content="Ubuntu">
<meta property="article:tag" content="LCD">
<meta property="article:tag" content="ST7789">
<meta property="article:tag" content="ESP32">
<meta property="article:tag" content="乐鑫">
<meta property="article:tag" content="SDK-IDF">
<meta property="article:tag" content="液晶屏">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><link rel="shortcut icon" href="/img/favicon_1.png"><link rel="canonical" href="https://zml3589110.github.io/posts/1827825660"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: ZhaoYichen","link":"链接: ","source":"来源: 赵逸尘个人博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ESP32使用SPI总线驱动LCD',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-07-18 10:52:58'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.1.1"><link rel="alternate" href="/atom.xml" title="赵逸尘个人博客" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">220</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">370</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">139</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">赵逸尘个人博客</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">ESP32使用SPI总线驱动LCD</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-07-18T02:34:20.000Z" title="发表于 2024-07-18 10:34:20">2024-07-18</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-07-18T02:52:58.853Z" title="更新于 2024-07-18 10:52:58">2024-07-18</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Linux/">Linux</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%B9%90%E9%91%AB/">乐鑫</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ESP32/">ESP32</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ST7789/">ST7789</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>18分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="ESP32使用SPI总线驱动LCD"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="ST7789液晶屏开发"><a href="#ST7789液晶屏开发" class="headerlink" title="ST7789液晶屏开发"></a>ST7789液晶屏开发</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在前言里面我想告诉你一些在对一款新的处理器的学习中，我们会遇到的那些错误，并且我相信这绝对不会是我一个人会出现的问题，出现这种问题首先原因是处理器的教程不够全面，没有像stm32一样一套保姆级别的教程能够一点一点引导着大家去学习，第二个原因就是esp32更新版本很快，导致一些教程会因为大版本的更新而不能使用。这里我就想站在初学者的角度来进行一番探索，也希望大家看完我出错的的过程后能够有所启发。</p>
<h2 id="初次尝试"><a href="#初次尝试" class="headerlink" title="初次尝试"></a>初次尝试</h2><p>在学习一款处理器的过程中，如何连接外设，配置外设接口并且成功驱动外设是非常重要的，经过前面的学习，我们结合其他处理器的学习经验，例如stm32，再结合乐鑫官方的教程和示例工程，其实是很容易就能控制一些常规的GPIO口，USART，I2C接口的外设或者通信。</p>
<p> 但是在我学习到LCD屏幕时，却遇到了很大的阻碍，和往常一样，在我准备配置这块1.3寸的驱动为st7789的屏幕时，我照例打开乐鑫官方的编程指南<a target="_blank" rel="noopener" href="https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/index.html">ESP-IDF 编程指南 - ESP32 - — ESP-IDF 编程指南 latest 文档 (espressif.com)</a>。</p>
<p>找到API参考，外设API，进而找到LCD这个目录，然后我就发现没有中文，这种情况我已经不是第一次遇到了，所以我很熟练的进行手册的版本切换，从原来的master版切换到v5.1.3版本，切换完成后我就看到它上面提示到最新稳定版是v5.2.1，所以我就又点击它切换到5.2.1版本。但是令人失望的是依旧没有出现我们想要的中文。那么我就明白了这一个说明大概率是没有中文的，但是没关系，英文版本我们一样看得懂，毕竟现在互联网这么发达，找到一个翻译实在是太容易了。</p>
<img src="/posts/undefined/dd1e1868604f49c2854c1d7009017cc3.png" class="" title="img">

<p><strong>首先映入眼帘的就是功能概述了，我从中提取到三个关键信息</strong></p>
<img src="/posts/undefined/468568ea80d64db1b547a29ef878a501.png" class="" title="img">

<ol>
<li>乐鑫提供了开箱即用的LCD驱动程序</li>
<li>有安装驱动程序的步骤</li>
<li>有控制LCD IO的API</li>
</ol>
<p>我这一看这不是妥了吗，基本上和之前GPIO，USART，I2C一样，按着官方的教程一步一步来，应该很轻松就能把这个屏幕初始化完成。殊不知这才是噩梦的开始。</p>
<h2 id="并没有找到驱动"><a href="#并没有找到驱动" class="headerlink" title="并没有找到驱动"></a>并没有找到驱动</h2><p>首先是即使乐鑫官方明说了有st7789的驱动程序，我也没有在乐鑫组件注册表中找到它，上面所提到的两款驱动，st7789和ssd1306，我只能搜索到ssd1306的驱动组件。但是这也无伤大雅，驱动组件中无非是定义着一些有关驱动的参数罢了，相关参数我们完全可以按照stm32开发时的流程，直接在st7789驱动的数据手册里面或者是商家给的驱动说明里面提取即可。</p>
<h2 id="初次尝试安装SPI-LCD-IO-驱动程序"><a href="#初次尝试安装SPI-LCD-IO-驱动程序" class="headerlink" title="初次尝试安装SPI LCD IO 驱动程序"></a>初次尝试安装SPI LCD IO 驱动程序</h2><p>然后就是去点击<a target="_blank" rel="noopener" href="https://docs.espressif.com/projects/esp-idf/zh_CN/v5.2.1/esp32/api-reference/peripherals/lcd.html#spi-lcd-panel">SPI Interfaced LCD</a>链接进入安装SPI LCD IO 驱动程序然后获取面板句柄的步骤的页面，实际上这些内容就在下面，直接向下滚动就能够看到。</p>
<img src="/posts/undefined/631a4fc290534e5d81e3d808f48e3617.png" class="" title="img">

<img src="/posts/undefined/084feadae0f1487593da11e225544202.png" class="" title="img">

<img src="/posts/undefined/7f412e5074f343d1abb0b4c4531c9a16.png" class="" title="img">

<p>我这一看，嚯，一二三步骤都标好了，这不就是我最需要的吗，当时我心里还在想，乐鑫官方是真的贴心啊，学习成本大大降低了，之后就是我按照上面的三个步骤，进行我的SPI配置，先创建SPI总线，然后从 SPI 总线分配 LCD IO 设备句柄，最后就是安装液晶屏控制器驱动程序，一切都是那么的水到渠成。</p>
<h2 id="初次使用控制LCD-IO的API"><a href="#初次使用控制LCD-IO的API" class="headerlink" title="初次使用控制LCD IO的API"></a>初次使用控制LCD IO的API</h2><p> 依旧是点击<a target="_blank" rel="noopener" href="https://docs.espressif.com/projects/esp-idf/zh_CN/v5.2.1/esp32/api-reference/peripherals/lcd.html#lcd-panel-operations">LCD 面板 IO 操作</a> 链接，转到下图界面</p>
<img src="/posts/undefined/f15c81856f9a46c692785fef6b1870ed.png" class="" title="img">

<p>然后我选择了这三个看起来有用的初始化函数，进行一一调用。但是当我调用完成以后，我迷茫了，是的跟着手册一路配置加初始化到这里我不知道我该干什么了，按理说我们现在已经初始化完成了SPI和LCD的相关配置，接着就是收发数据了，但是我完全不知道该如何向LCD屏中发送数据，而手册中唯一和发送数据相关的就是esp_lcd_panel_draw_bitmap()函数，这个函数是将用户提供的颜色缓冲区绘制到LCD屏幕上。</p>
<p>当时我没有感觉到又哪里不对，心里想的是这不就是个画点函数，有了画点函数我不随便编写其他的绘画函数。所以当时我选择了先编译一下程序看看，一方面是想看初始化完成后到底是个什么情况，另一方面也是要确定我的程序确实没有问题能够运行起来。</p>
<p>很成功，在解决了编译时出现的小问题后，程序编译成功并且也烧录成功了，但是屏幕这个时候并没有点亮。在了解到初始化完成后屏幕也不会点亮，必须手动填充色块的相关情况后，我决定使用esp_lcd_panel_draw_bitmap()这个函数来试着填充一下屏幕区域，但是这时候我发现了另外的问题，虽然这个函数的参数和画点函数比较相似，都是传递起始坐标和结束坐标，另外就是传递一个颜色指针。但是我如果想填满整个屏幕，我就需要定义一个240x240大小的数组，并且我还要给他填充数据，这也太傻鸟了吧，我在心里忍不住吐槽。于是我就想着只填充几行看看效果就行，定义了一个20x20的数组，将数组的地址传递进去之后，按照它这函数的作用，应该是会显示一个小方块，不过经过我重新烧录验证，屏幕依旧是是没有任何反应。20的数组，将数组的地址传递进去之后，按照它这函数的作用，应该是会显示一个小方块，不过经过我重新烧录验证，屏幕依旧是是没有任何反应。</p>
<p>到这里我就开始怀疑我的程序到底是不是有问题了，于是我不再局限于官方的编程手册，转而到网络上搜索相关的教程，事实证明我这一步决策是十分正确的，网上的相关教程确实补充了我之前根据官方编程手册的一些不足之处（实际上也是官方的另外的教程罢了）。</p>
<h2 id="二次尝试"><a href="#二次尝试" class="headerlink" title="二次尝试"></a>二次尝试</h2><p>由于大部分人使用esp32做项目都是用Arduino这个开发环境，所以我在搜索教程时也遇到了一定困难，中间具体的搜索过程我就不细说了，直接讲最后的搜索结果，我在bilibili上找到了一个用esp-idf移植驱动一块触摸屏的教程，起初一段我觉得这个教程讲的十分的详细，所以第二次我就完全按照这个教程来进行学习<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Yc411y7bb/?spm_id_from=333.999.0.0&vd_source=ba7ed6e0e74823b6b98addc6136682c2">ESP32-S3 开发 SPI 屏【DIY 智能手表】_哔哩哔哩_bilibili</a>。</p>
<p>依照这个教程，我们再次找到了另外的LCD官方教程<a target="_blank" rel="noopener" href="https://docs.espressif.com/projects/esp-iot-solution/zh_CN/latest/display/lcd/spi_lcd.html#id3">SPI LCD 详解 - - — ESP-IoT-Solution latest 文档 (espressif.com)</a>， 这次的教程相比之前详细了不少，经过阅读这篇教程（视频前面上其实也是参考了这个教程），我发现我在第一次尝试的时候没有初始化SPI总线 ，也没有配置LCD 驱动 IC 的初始化命令及参数。</p>
<img src="/posts/undefined/4cc1efee5ecc4d2b8ffa3ea096b05deb.png" class="" title="img">

<p>所以根据视频上的流程，我对之前的代码进行了更改，最后呈现出一下状态，由于我没有使用官方的驱动配置头文件，没有想视频中一样修改一下其他同类型的驱动头文件，所以关于驱动头文件里面声明的结构体我直接放在了我自己的头文件当中：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;bsp_spi_lcd.h&quot;</span></span></span><br><span class="line"><span class="comment">// static const char BACK_COLOR[240][240] ;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">char</span> *TAG = <span class="string">&quot;st7789-example&quot;</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">st7789_lcd_init_cmd_t</span> lcd_init_cmds [] =&#123;</span><br><span class="line">    <span class="comment">/* &#123;cmd, &#123; data &#125;, data_size, delay_ms&#125; &quot;*/</span></span><br><span class="line">    <span class="comment">// &#123;0x36, (uint8_t [])&#123;0x00&#125;, 1, 0&#125;,</span></span><br><span class="line">    <span class="comment">// &#123;0x3A, (uint8_t [])&#123;0x05&#125;, 1, 0&#125;,</span></span><br><span class="line">    &#123;<span class="number">0xB2</span>, (<span class="keyword">uint8_t</span> [])&#123;<span class="number">0x0C</span>,<span class="number">0x0C</span>,<span class="number">0x00</span>,<span class="number">0x33</span>,<span class="number">0x33</span>&#125;, <span class="number">5</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xB7</span>, (<span class="keyword">uint8_t</span> [])&#123;<span class="number">0x35</span>&#125;, <span class="number">1</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xBB</span>, (<span class="keyword">uint8_t</span> [])&#123;<span class="number">0x19</span>&#125;, <span class="number">1</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xC0</span>, (<span class="keyword">uint8_t</span> [])&#123;<span class="number">0x2C</span>&#125;, <span class="number">1</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xC2</span>, (<span class="keyword">uint8_t</span> [])&#123;<span class="number">0x01</span>&#125;, <span class="number">1</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xC3</span>, (<span class="keyword">uint8_t</span> [])&#123;<span class="number">0x12</span>&#125;, <span class="number">1</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xC4</span>, (<span class="keyword">uint8_t</span> [])&#123;<span class="number">0x20</span>&#125;, <span class="number">1</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xC6</span>, (<span class="keyword">uint8_t</span> [])&#123;<span class="number">0x0F</span>&#125;, <span class="number">1</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xD0</span>, (<span class="keyword">uint8_t</span> [])&#123;<span class="number">0xA4</span>,<span class="number">0xA1</span>&#125;, <span class="number">2</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xE0</span>, (<span class="keyword">uint8_t</span> [])&#123;<span class="number">0xD0</span>,<span class="number">0x04</span>,<span class="number">0x0D</span>,<span class="number">0x11</span>,<span class="number">0x13</span>,<span class="number">0x2B</span>,<span class="number">0x3F</span>,<span class="number">0x54</span>,<span class="number">0x4C</span>,<span class="number">0x18</span>,<span class="number">0x0D</span>,<span class="number">0x0B</span>,<span class="number">0x1F</span>,<span class="number">0x23</span>&#125;, <span class="number">14</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xE1</span>, (<span class="keyword">uint8_t</span> [])&#123;<span class="number">0xD0</span>,<span class="number">0x04</span>,<span class="number">0x0C</span>,<span class="number">0x11</span>,<span class="number">0x13</span>,<span class="number">0x2C</span>,<span class="number">0x3F</span>,<span class="number">0x44</span>,<span class="number">0x51</span>,<span class="number">0x2F</span>,<span class="number">0x1F</span>,<span class="number">0x1F</span>,<span class="number">0x20</span>,<span class="number">0x23</span>&#125;, <span class="number">14</span>, <span class="number">0</span>&#125;,</span><br><span class="line"> </span><br><span class="line">    &#123;<span class="number">0x21</span>, (<span class="keyword">uint8_t</span> [])&#123;<span class="number">0x00</span>&#125;, <span class="number">1</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0x11</span>, (<span class="keyword">uint8_t</span> [])&#123;<span class="number">0x00</span>&#125;, <span class="number">1</span>, <span class="number">120</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0x29</span>, (<span class="keyword">uint8_t</span> [])&#123;<span class="number">0x00</span>&#125;, <span class="number">1</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0x2A</span>, (<span class="keyword">uint8_t</span> [])&#123;<span class="number">0x00</span>&#125;, <span class="number">1</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0x2B</span>, (<span class="keyword">uint8_t</span> [])&#123;<span class="number">0x00</span>&#125;, <span class="number">1</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0x2C</span>, (<span class="keyword">uint8_t</span> [])&#123;<span class="number">0x00</span>&#125;, <span class="number">1</span>, <span class="number">0</span>&#125;,</span><br><span class="line"> </span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//初始化接口设备</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Lcd_Init</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">esp_lcd_panel_io_handle_t</span> io_handle = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">esp_lcd_panel_handle_t</span> panel_handle = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="comment">// static lv_disp_draw_buf_t disp_buf;</span></span><br><span class="line">    <span class="comment">// static lv_disp_drv_t disp_drv;</span></span><br><span class="line"> </span><br><span class="line">     <span class="comment">/***************************************** 1.初始化总线 **************************************************/</span></span><br><span class="line">    ESP_LOGI(TAG, <span class="string">&quot;Initialize SPI bus&quot;</span>);</span><br><span class="line">    <span class="keyword">spi_bus_config_t</span> buscfg = &#123;</span><br><span class="line">        .sclk_io_num = PIN_NUM_CLK,   <span class="comment">// 连接 LCD SCK（SCL） 信号的 IO 编号</span></span><br><span class="line">        .mosi_io_num = PIN_NUM_MOSI,  <span class="comment">// 连接 LCD MOSI（SDO、SDA） 信号的 IO 编号</span></span><br><span class="line">        .miso_io_num = <span class="number">-1</span>,  <span class="comment">// 连接 LCD MISO（SDI） 信号的 IO 编号，如果不需要从 LCD 读取数据，可以设为 `-1`</span></span><br><span class="line">        .quadwp_io_num = <span class="number">-1</span>,          <span class="comment">// 必须设置且为 `-1`</span></span><br><span class="line">        .quadhd_io_num = <span class="number">-1</span>,          <span class="comment">// 必须设置且为 `-1`</span></span><br><span class="line">        .max_transfer_sz = LCD_H_RES * LCD_W_RES * <span class="keyword">sizeof</span>(<span class="keyword">uint16_t</span>), <span class="comment">// 表示 SPI 单次传输允许的最大字节数上限，通常设为全屏大小即可</span></span><br><span class="line">    &#125;;</span><br><span class="line">    ESP_ERROR_CHECK(spi_bus_initialize(SPI3_HOST, &amp;buscfg, SPI_DMA_CH_AUTO));</span><br><span class="line">                                          <span class="comment">// 第 1 个参数表示使用的 SPI 主机 ID，和后续创建接口设备时保持一致</span></span><br><span class="line">                                          <span class="comment">// 第 3 个参数表示使用的 DMA 通道号，默认设置为 `SPI_DMA_CH_AUTO` 即可</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">/****************************************** 2.创建接口设备 **************************************************/</span></span><br><span class="line">    ESP_LOGI(TAG, <span class="string">&quot;Install panel IO&quot;</span>);</span><br><span class="line">    <span class="keyword">esp_lcd_panel_io_spi_config_t</span> io_config = &#123;</span><br><span class="line">        .dc_gpio_num = PIN_NUM_DC,</span><br><span class="line">        .cs_gpio_num = <span class="number">-1</span>,       <span class="comment">// 连接 LCD CS 信号的 IO 编号，可以设为 `-1` 表示不使用</span></span><br><span class="line">        .pclk_hz = LCD_PIXEL_CLOCK_HZ,           <span class="comment">//Clock out at 20 MHz</span></span><br><span class="line">        .lcd_cmd_bits = LCD_CMD_BITS,       <span class="comment">// 单位 LCD 命令的比特数，应为 8 的整数倍</span></span><br><span class="line">        .lcd_param_bits = LCD_PARAM_BITS,   <span class="comment">// 单位 LCD 参数的比特数，应为 8 的整数倍</span></span><br><span class="line">        .spi_mode = <span class="number">3</span>,         <span class="comment">// SPI 模式（0-3），需根据 LCD 驱动 IC 的数据手册以及硬件的配置确定（如 IM[3:0]）</span></span><br><span class="line">        .trans_queue_depth = <span class="number">10</span>,        <span class="comment">// SPI 设备传输数据的队列深度，一般设为 10 即可</span></span><br><span class="line">        <span class="comment">// .on_color_trans_done = example_notify_lvgl_flush_ready,   // 单次调用 `esp_lcd_panel_draw_bitmap()` 传输完成后的回调函数</span></span><br><span class="line">        <span class="comment">// .user_ctx = &amp;disp_drv,</span></span><br><span class="line">        .flags = &#123;            <span class="comment">// 以下为 SPI 时序的相关参数，需根据 LCD 驱动 IC 的数据手册以及硬件的配置确定</span></span><br><span class="line">            .sio_mode = <span class="number">0</span>,    <span class="comment">// 通过一根数据线（MOSI）读写数据，0: Interface I 型，1: Interface II 型</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// Attach the LCD to the SPI bus</span></span><br><span class="line">    ESP_ERROR_CHECK(esp_lcd_new_panel_io_spi((<span class="keyword">esp_lcd_spi_bus_handle_t</span>)SPI3_HOST, &amp;io_config, &amp;io_handle));</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/***************************************** 3.创建 LCD 设备 ***************************************************/</span></span><br><span class="line">    ESP_LOGI(TAG, <span class="string">&quot;Install ST7789 panel driver&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">st7789_vendor_config_t</span> vendor_config = &#123;  <span class="comment">// 用于替换驱动组件中的初始化命令及参数</span></span><br><span class="line">        .init_cmds = lcd_init_cmds,</span><br><span class="line">        .init_cmds_size = <span class="keyword">sizeof</span>(lcd_init_cmds) / <span class="keyword">sizeof</span>(<span class="keyword">st7789_lcd_init_cmd_t</span>),</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">esp_lcd_panel_dev_config_t</span> panel_config = &#123;</span><br><span class="line">        .reset_gpio_num = PIN_NUM_RES,    <span class="comment">// 连接 LCD 复位信号的 IO 编号，可以设为 `-1` 表示不使用</span></span><br><span class="line">        .rgb_ele_order = LCD_RGB_ELEMENT_ORDER_RGB,   <span class="comment">// 像素色彩的元素顺序（RGB/BGR），</span></span><br><span class="line">                                                    <span class="comment">//  一般通过命令 `LCD_CMD_MADCTL（36h）` 控制</span></span><br><span class="line">        .bits_per_pixel = <span class="number">16</span>,  <span class="comment">// 色彩格式的位数（RGB565：16，RGB666：18），</span></span><br><span class="line">                                                    <span class="comment">// 一般通过命令 `LCD_CMD_COLMOD（3Ah）` 控制</span></span><br><span class="line">        .vendor_config = &amp;vendor_config,           <span class="comment">// 用于替换驱动组件中的初始化命令及参数</span></span><br><span class="line">    &#125;;</span><br><span class="line">    ESP_ERROR_CHECK(esp_lcd_new_panel_st7789(io_handle, &amp;panel_config, &amp;panel_handle));</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/****************************************** 4.初始化 LCD 设备 *************************************************/</span></span><br><span class="line">    ESP_ERROR_CHECK(esp_lcd_panel_reset(panel_handle));</span><br><span class="line">    ESP_ERROR_CHECK(esp_lcd_panel_init(panel_handle));</span><br><span class="line">    ESP_ERROR_CHECK(esp_lcd_panel_disp_on_off(panel_handle, <span class="literal">true</span>));</span><br><span class="line">    <span class="comment">// esp_lcd_panel_draw_bitmap(panel_handle,0,0,240,240,BACK_COLOR);</span></span><br></pre></td></tr></table></figure>


<p>当我完成上述代码后，由于视频中是触摸屏，并且还要移植LVGL图形界面，但是我现在还不想一步到位，我只想先实现屏幕能够点亮，能够显示静态的文字跟图片，所以视频后面关于配置触屏I2C以及LVGL的移植代码我就并没有添加。</p>
<p>到了这一步应该是配置已经事无巨细了，可实际当我满怀信息的去烧录完成等着屏幕点亮，却让我异常失望，屏幕并没有亮，这不禁让我怀疑我的屏是不是有问题。这个想法一下子就让我闻到了成功的气息，而问题的转折点也就出现在这里。</p>
<h2 id="最终尝试"><a href="#最终尝试" class="headerlink" title="最终尝试"></a>最终尝试</h2><p>为了测试我的屏幕是否有问题，我使用了商家给的代码，并且把代码移植到我自己的F103C8T6程序上，结果是能够使用商家的程序成功点亮这块屏幕，看着keil中熟悉的代码，然后我就有了新的想法，我们不要使用乐鑫教程中普遍使用的官方的配置函数，而是自己通过SPI总线向stm32中一样配置发送命令，发送数据的函数，然后所有的流程都严格依照32中的流程进行，这样不就能够可行了吗。</p>
<p><strong>所以我最后抛弃掉了所有的教程，开始了自己对32控制lcd屏幕的流程的完全移植，到了最后我重要是功夫不负有心人，在第一次尝试后的第二天完成了屏幕点亮。</strong></p>
<h1 id="正片"><a href="#正片" class="headerlink" title="正片"></a>正片</h1><h2 id="配置SPI控制器"><a href="#配置SPI控制器" class="headerlink" title="配置SPI控制器"></a>配置SPI控制器</h2><p>由于屏幕使用了SPI协议进行通信，那么我们点亮屏幕的第一步就是配置SPI，这一段在我们之前尝试的时候都有提到，我把代码放在这里，相信大家看到代码后就能理解这一环节到底在做些什么：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PIN_NUM_MISO -1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PIN_NUM_MOSI 23</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PIN_NUM_CLK  18</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PIN_NUM_CS   -1</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">vspi_init</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">static</span> <span class="keyword">spi_device_handle_t</span> spi;    <span class="comment">//创建spi</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">spi_bus_config_t</span> buscfg=&#123;   <span class="comment">//spi定义</span></span><br><span class="line">    .miso_io_num=PIN_NUM_MISO, </span><br><span class="line">    .mosi_io_num=PIN_NUM_MOSI,</span><br><span class="line">    .sclk_io_num=PIN_NUM_CLK,</span><br><span class="line">    .quadwp_io_num=<span class="number">-1</span>,</span><br><span class="line">    .quadhd_io_num=<span class="number">-1</span>,</span><br><span class="line">    .max_transfer_sz=<span class="number">4092</span></span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">spi_device_interface_config_t</span> devcfg = &#123;</span><br><span class="line">    .clock_speed_hz = SPI_MASTER_FREQ_40M,</span><br><span class="line">    .mode = <span class="number">3</span>,</span><br><span class="line">    .spics_io_num   = PIN_NUM_CS,</span><br><span class="line">    .queue_size = <span class="number">7</span></span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">vspi_init</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    spi_bus_initialize(SPI3_HOST,&amp;buscfg,SPI_DMA_CH_AUTO);</span><br><span class="line">    spi_bus_add_device(SPI3_HOST, &amp;devcfg, &amp;spi);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我稍微解释一下，大家可以看到我PIN_NUM_CS和PIN_NUM_MISO都定义为了-1，这是因为我们这块屏幕并没有使用这两根线，所以给-1表示不使用此功能。</p>
<h2 id="编写LCD屏幕初始化函数"><a href="#编写LCD屏幕初始化函数" class="headerlink" title="编写LCD屏幕初始化函数"></a>编写LCD屏幕初始化函数</h2><h3 id="LCD-Init"><a href="#LCD-Init" class="headerlink" title="LCD_Init"></a>LCD_Init</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*st7789*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_Init</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    esp_rom_gpio_pad_select_gpio(LCD_RES);   <span class="comment">//gpio_pad_select_gpio(LCD_RES)之前</span></span><br><span class="line">    esp_rom_gpio_pad_select_gpio(LCD_DC);   <span class="comment">//gpio_pad_select_gpio(LCD_DC)</span></span><br><span class="line">    gpio_set_direction(LCD_RES,GPIO_MODE_OUTPUT);    <span class="comment">//设置io22为输出模式</span></span><br><span class="line">    gpio_set_direction(LCD_DC,GPIO_MODE_OUTPUT);    <span class="comment">//设置io21为输出模式</span></span><br><span class="line"> </span><br><span class="line">	vspi_init();</span><br><span class="line">	LCD_RES_CLR();</span><br><span class="line">	DELAY(<span class="number">20</span>);</span><br><span class="line">	LCD_RES_SET();</span><br><span class="line">	DELAY(<span class="number">20</span>);</span><br><span class="line">	<span class="comment">//BLK_OFF();</span></span><br><span class="line">	<span class="comment">// DELAY(100);</span></span><br><span class="line"> </span><br><span class="line">	<span class="comment">// LCD_WR_REG(0x11); </span></span><br><span class="line">	<span class="comment">// DELAY(120);</span></span><br><span class="line"> </span><br><span class="line">	LCD_WR_REG(<span class="number">0x36</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0xc0</span>);</span><br><span class="line">	LCD_WR_REG(<span class="number">0x3A</span>); </span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x05</span>);</span><br><span class="line"> </span><br><span class="line">	LCD_WR_REG(<span class="number">0xB2</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x0C</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x0C</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x00</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x33</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x33</span>); </span><br><span class="line"> </span><br><span class="line">	LCD_WR_REG(<span class="number">0xB7</span>); </span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x35</span>);  </span><br><span class="line"> </span><br><span class="line">	LCD_WR_REG(<span class="number">0xBB</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x19</span>);</span><br><span class="line"> </span><br><span class="line">	LCD_WR_REG(<span class="number">0xC0</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x2C</span>);</span><br><span class="line"> </span><br><span class="line">	LCD_WR_REG(<span class="number">0xC2</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x01</span>);</span><br><span class="line"> </span><br><span class="line">	LCD_WR_REG(<span class="number">0xC3</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x12</span>);   </span><br><span class="line"> </span><br><span class="line">	LCD_WR_REG(<span class="number">0xC4</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x20</span>);  </span><br><span class="line"> </span><br><span class="line">	LCD_WR_REG(<span class="number">0xC6</span>); </span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x0F</span>);    </span><br><span class="line"> </span><br><span class="line">	LCD_WR_REG(<span class="number">0xD0</span>); </span><br><span class="line">	LCD_WR_DATA8(<span class="number">0xA4</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0xA1</span>);</span><br><span class="line"> </span><br><span class="line">	LCD_WR_REG(<span class="number">0xE0</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0xD0</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x04</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x0D</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x11</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x13</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x2B</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x3F</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x54</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x4C</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x18</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x0D</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x0B</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x1F</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x23</span>);</span><br><span class="line"> </span><br><span class="line">	LCD_WR_REG(<span class="number">0xE1</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0xD0</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x04</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x0C</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x11</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x13</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x2C</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x3F</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x44</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x51</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x2F</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x1F</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x1F</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x20</span>);</span><br><span class="line">	LCD_WR_DATA8(<span class="number">0x23</span>);</span><br><span class="line"> </span><br><span class="line">	LCD_WR_REG(<span class="number">0x21</span>); </span><br><span class="line">	LCD_WR_REG(<span class="number">0x11</span>);</span><br><span class="line">	LCD_WR_REG(<span class="number">0x29</span>);</span><br><span class="line"> </span><br><span class="line">	LCD_Clear(<span class="number">0xFFFF</span>);</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这一步就是初始化LCD的最关键的步骤，就是发送命令配置屏幕的参数，这一部分基本上就是参考购买屏幕的商家给的示例程序来进行配置</p>
<p>可以看到我们在初始化的时候用到了发送命令和发送8位数据的函数，这需要我们自己编写，我这里的所有步骤都是基于对stm32的完全模仿，而且这也是我们初学esp32的最好方式，不要一上来就想着使用官方所提供好的功能函数，因为很可能你根本就搞不明白这些功能函数的到底有什么用处。</p>
<h3 id="LCD-WR-GER"><a href="#LCD-WR-GER" class="headerlink" title="LCD_WR_GER"></a>LCD_WR_GER</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_WR_REG</span><span class="params">(<span class="keyword">uint8_t</span> dat)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	LCD_DC_CLR();<span class="comment">//写命令</span></span><br><span class="line">	lcd_cmd(dat);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="LCD-WR-DATA8"><a href="#LCD-WR-DATA8" class="headerlink" title="LCD_WR_DATA8"></a>LCD_WR_DATA8</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_WR_DATA8</span><span class="params">(<span class="keyword">uint8_t</span> dat)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	LCD_DC_SET();<span class="comment">//写数据</span></span><br><span class="line">	lcd_cmd(dat);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="lcd-cmd"><a href="#lcd-cmd" class="headerlink" title="lcd_cmd"></a>lcd_cmd</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">lcd_cmd</span><span class="params">(<span class="keyword">const</span> <span class="keyword">uint8_t</span> cmd)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">esp_err_t</span> ret;</span><br><span class="line">    <span class="keyword">spi_transaction_t</span> t;</span><br><span class="line">    <span class="built_in">memset</span>(&amp;t, <span class="number">0</span>, <span class="keyword">sizeof</span>(t));       <span class="comment">//Zero out the transaction</span></span><br><span class="line">    t.length=<span class="number">8</span>;                     <span class="comment">//Command is 8 bits</span></span><br><span class="line">    t.tx_buffer=&amp;cmd;               <span class="comment">//The data is the cmd itself</span></span><br><span class="line">    t.user=(<span class="keyword">void</span>*)<span class="number">0</span>;                <span class="comment">//D/C needs to be set to 0</span></span><br><span class="line">    ret=spi_device_polling_transmit(spi, &amp;t);  <span class="comment">//Transmit!</span></span><br><span class="line">    assert(ret==ESP_OK);            <span class="comment">//Should have had no issues.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面我们就是要解决最后第一个问题了，可以看到的是，我在LCD_Init中最后使用了一个清屏函数，只要我们想办法编写这个刷白函数，就能点亮屏幕，实现全屏颜色显示，而且在上面我们已经编写过传输8位指令或者数据的一个函数lcd_cmd，我们要使用这个函数的话就要循环调用240<em>240</em>2次lcd_cmd函数，这样做可以是可以但是有点拖拉，所以在这个函数的基础上，我们可以编写一个一次能够传送指定数据大小的函数:</p>
<h4 id="LCD-data-x"><a href="#LCD-data-x" class="headerlink" title="LCD_data_x"></a>LCD_data_x</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_data_x</span><span class="params">(<span class="keyword">uint16_t</span> *dat,<span class="keyword">uint32_t</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">spi_transaction_t</span> t;</span><br><span class="line">    <span class="built_in">memset</span>(&amp;t, <span class="number">0</span>, <span class="keyword">sizeof</span>(t));       <span class="comment">//Zero out the transaction</span></span><br><span class="line">    t.length=len;                     <span class="comment">//Command is 8 bits</span></span><br><span class="line">    t.tx_buffer=dat;               <span class="comment">//The data is the cmd itself</span></span><br><span class="line">    t.user=(<span class="keyword">void</span>*)<span class="number">0</span>;                <span class="comment">//D/C needs to be set to 0</span></span><br><span class="line">    <span class="keyword">esp_err_t</span> ret=spi_device_polling_transmit(spi, &amp;t);  <span class="comment">//Transmit!</span></span><br><span class="line">    assert(ret==ESP_OK);            <span class="comment">//Should have had no issues.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>有了这个函数，我们在编写清屏函数时就不用调用如此之多的lcd_cmd了，下面就是我对清屏函数的实现：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCD_Clear</span><span class="params">(<span class="keyword">uint16_t</span> Color)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	LCD_Address_Set(<span class="number">0</span>,<span class="number">0</span>,LCD_W<span class="number">-1</span>,LCD_H<span class="number">-1</span>);</span><br><span class="line">	LCD_DC_SET();<span class="comment">//写数据</span></span><br><span class="line">	<span class="keyword">uint16_t</span> color_temp[<span class="number">240</span>*<span class="number">2</span>];</span><br><span class="line">	<span class="built_in">memset</span>(color_temp, Color, <span class="keyword">sizeof</span>(color_temp));</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">uint16_t</span> i=<span class="number">0</span>;i&lt;LCD_W/<span class="number">2</span>;i++)&#123;</span><br><span class="line">	 	LCD_data_x(color_temp,<span class="number">240</span>*<span class="number">16</span>*<span class="number">2</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以发现在清屏函数中我一次传输了两行的颜色数据，所以for循环中我只需要循环二分之一的屏幕宽度次就可以了，这样的操作相比于一次传输半个颜色数据在输出效率上会高一些，因为我们使用的16位颜色，但是之前的函数一次才传递8位，意味着我们一个颜色数据就要传输两次才能传输成功，现在这样就显然合理了很多。</p>
<p><strong>上面的函数里面我们用到了许多宏，这些我都把它放在了头文件中，在下面放出供大家参考使用：</strong></p>
<h4 id="LCD-Init-h"><a href="#LCD-Init-h" class="headerlink" title="LCD_Init.h"></a>LCD_Init.h</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LCD_W 240</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LCD_H 240</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LCD_RES GPIO_NUM_22</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LCD_DC  GPIO_NUM_21</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LCD_BLK GPIO_NUM_12</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BLK_ON()    gpio_set_level(LCD_BLK,1);</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BLK_OFF()   gpio_set_level(LCD_BLK,0);</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LCD_SCL_SET() gpio_set_level(LCD_SCL,1);</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LCD_SCL_CLR() gpio_set_level(LCD_SCL,0);</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LCD_SDA_SET() gpio_set_level(LCD_SDA,1);</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LCD_SDA_CLR() gpio_set_level(LCD_SDA,0);</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LCD_CS_SET() gpio_set_level(LCD_CS,1);</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LCD_CS_CLR() gpio_set_level(LCD_CS,0);</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LCD_RES_SET() gpio_set_level(LCD_RES,1);</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LCD_RES_CLR() gpio_set_level(LCD_RES,0);</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LCD_DC_SET() gpio_set_level(LCD_DC,1);</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LCD_DC_CLR() gpio_set_level(LCD_DC,0);</span></span><br></pre></td></tr></table></figure>

<p>至此，大家可以在主函数中尽情的调用LCD_Init函数来对屏幕进行初始化了，相信初始化完成后，你们也能成功点亮自己LCD屏。</p>
<h2 id="基于-ESP32-的-LCD-模块（ST7789）开发"><a href="#基于-ESP32-的-LCD-模块（ST7789）开发" class="headerlink" title="基于 ESP32 的 LCD 模块（ST7789）开发"></a>基于 ESP32 的 LCD 模块（ST7789）开发</h2><img src="/posts/undefined/image-20240718105130913.png" class="" title="image-20240718105130913">

<h3 id="初始化命令"><a href="#初始化命令" class="headerlink" title="初始化命令"></a>初始化命令</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">DRAM_ATTR <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">uint8_t</span> LCD_ORIENTATION_VALUES[]=&#123;</span><br><span class="line">    <span class="number">0x00</span>,   <span class="comment">// PORTRAIT</span></span><br><span class="line">    <span class="number">0xC0</span>,   <span class="comment">// PORTRAIT_INVERTED</span></span><br><span class="line">    <span class="number">0x70</span>,   <span class="comment">// LANDSCAPE</span></span><br><span class="line">    <span class="number">0xA0</span>    <span class="comment">// LANDSCAPE_INVERTED</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">char</span> *LCD_ORIENTATION_TAGS[]=&#123;</span><br><span class="line">    <span class="string">&quot;PORTRAIT&quot;</span>,           <span class="comment">// 纵向</span></span><br><span class="line">    <span class="string">&quot;PORTRAIT_INVERTED&quot;</span>,  <span class="comment">// 纵向（颠倒）</span></span><br><span class="line">    <span class="string">&quot;LANDSCAPE&quot;</span>,          <span class="comment">// 横向</span></span><br><span class="line">    <span class="string">&quot;LANDSCAPE_INVERTED&quot;</span>  <span class="comment">// 横向（颠倒）</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LCD_WIDTH       240 <span class="comment">// LCD 宽度像素</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LCD_HEIGHT      240 <span class="comment">// LCD 高度像素</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span>  VIEW_ORIENTATION   0 <span class="comment">// LCD 方向 取值范围 0-3</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">uint8_t</span> cmd;</span><br><span class="line">    <span class="keyword">uint8_t</span> data[<span class="number">16</span>];</span><br><span class="line">    <span class="keyword">uint8_t</span> databytes;</span><br><span class="line">&#125; <span class="keyword">lcd_init_cmd_t</span>;</span><br><span class="line"></span><br><span class="line">DRAM_ATTR <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">lcd_init_cmd_t</span> LCD_INIT_CMDS[]=&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    &#123;<span class="number">0x36</span>, &#123;LCD_ORIENTATION_VALUES[VIEW_ORIENTATION]&#125;, <span class="number">1</span>&#125;,</span><br><span class="line">    <span class="comment">/* Interface Pixel Format, 16bits/pixel for RGB/MCU interface */</span></span><br><span class="line">    &#123;<span class="number">0x3A</span>, &#123;<span class="number">0x05</span>&#125;, <span class="number">1</span>&#125;,</span><br><span class="line">    <span class="comment">/* Porch Setting */</span></span><br><span class="line">    &#123;<span class="number">0xB2</span>, &#123;<span class="number">0x0c</span>, <span class="number">0x0c</span>, <span class="number">0x00</span>, <span class="number">0x33</span>, <span class="number">0x33</span>&#125;, <span class="number">5</span>&#125;,</span><br><span class="line">    <span class="comment">/* Gate Control, Vgh=13.65V, Vgl=-10.43V */</span></span><br><span class="line">    &#123;<span class="number">0xB7</span>, &#123;<span class="number">0x35</span>&#125;, <span class="number">1</span>&#125;,</span><br><span class="line">    <span class="comment">/* VCOM Setting, VCOM=1.35V */</span></span><br><span class="line">    &#123;<span class="number">0xBB</span>, &#123;<span class="number">0x32</span>&#125;, <span class="number">1</span>&#125;,</span><br><span class="line">    <span class="comment">/* VDV and VRH Command Enable, enable=1 */</span></span><br><span class="line">    &#123;<span class="number">0xC2</span>, &#123;<span class="number">0x01</span>&#125;, <span class="number">1</span>&#125;,</span><br><span class="line">    <span class="comment">/* VRH Set, Vap=4.4+... */</span></span><br><span class="line">    &#123;<span class="number">0xC3</span>, &#123;<span class="number">0x15</span>&#125;, <span class="number">1</span>&#125;,</span><br><span class="line">    <span class="comment">/* VDV Set, VDV=0 */</span></span><br><span class="line">    &#123;<span class="number">0xC4</span>, &#123;<span class="number">0x20</span>&#125;, <span class="number">1</span>&#125;,</span><br><span class="line">    <span class="comment">/* Frame Rate Control, 60Hz, inversion=0 */</span></span><br><span class="line">    &#123;<span class="number">0xC6</span>, &#123;<span class="number">0x0f</span>&#125;, <span class="number">1</span>&#125;,</span><br><span class="line">    <span class="comment">/* Power Control 1, AVDD=6.8V, AVCL=-4.8V, VDDS=2.3V */</span></span><br><span class="line">    &#123;<span class="number">0xD0</span>, &#123;<span class="number">0xA4</span>, <span class="number">0xA1</span>&#125;, <span class="number">1</span>&#125;,</span><br><span class="line">    <span class="comment">/* Positive Voltage Gamma Control */</span></span><br><span class="line">    &#123;<span class="number">0xE0</span>, &#123;<span class="number">0xD0</span>,<span class="number">0x08</span>,<span class="number">0x0E</span>,<span class="number">0x09</span>,<span class="number">0x09</span>,<span class="number">0x05</span>,<span class="number">0x31</span>,<span class="number">0x33</span>,<span class="number">0x48</span>,<span class="number">0x17</span>,<span class="number">0x14</span>,<span class="number">0x15</span>,<span class="number">0x31</span>,<span class="number">0x34</span>&#125;, <span class="number">14</span>&#125;,</span><br><span class="line">    <span class="comment">/* Negative Voltage Gamma Control */</span></span><br><span class="line">    &#123;<span class="number">0xE1</span>, &#123;<span class="number">0xD0</span>,<span class="number">0x08</span>,<span class="number">0x0E</span>,<span class="number">0x09</span>,<span class="number">0x09</span>,<span class="number">0x15</span>,<span class="number">0x31</span>,<span class="number">0x33</span>,<span class="number">0x48</span>,<span class="number">0x17</span>,<span class="number">0x14</span>,<span class="number">0x15</span>,<span class="number">0x31</span>,<span class="number">0x34</span>&#125;, <span class="number">14</span>&#125;,</span><br><span class="line">    <span class="comment">/* Sleep Out */</span></span><br><span class="line">    &#123;<span class="number">0x11</span>, &#123;<span class="number">0</span>&#125;, <span class="number">0x80</span>&#125;,</span><br><span class="line">    <span class="comment">/* Display On */</span></span><br><span class="line">    &#123;<span class="number">0x29</span>, &#123;<span class="number">0</span>&#125;, <span class="number">0x80</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0</span>, &#123;<span class="number">0</span>&#125;, <span class="number">0xff</span>&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<img src="/posts/undefined/d8edf0ef5488462f90c314696719f4d9.jpg" class="" title="在这里插入图片描述">


<hr>
<h1 id="相关链接（侵删）"><a href="#相关链接（侵删）" class="headerlink" title="相关链接（侵删）"></a>相关链接（侵删）</h1><ol>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_51803729/article/details/136747907">在esp32上使用tftLCD屏幕（st7789驱动）</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/suyexuan/article/details/120962445">基于 ESP32 的 LCD 模块（ST7789）开发</a></li>
</ol>
<hr>
<center><font color=red>=================我是分割线=================</font></center>


<p><strong>欢迎到公众号来唠嗑:</strong></p>
<img src="https://pic4.zhimg.com/80/v2-eedc5dc7d30beedf4c2f1812df8e61a7_720w.jpg">

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://zml3589110.github.io">ZhaoYichen</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://zml3589110.github.io/posts/1827825660.html">https://zml3589110.github.io/posts/1827825660.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://zml3589110.github.io" target="_blank">赵逸尘个人博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Ubuntu/">Ubuntu</a><a class="post-meta__tags" href="/tags/LCD/">LCD</a><a class="post-meta__tags" href="/tags/ST7789/">ST7789</a><a class="post-meta__tags" href="/tags/ESP32/">ESP32</a><a class="post-meta__tags" href="/tags/%E4%B9%90%E9%91%AB/">乐鑫</a><a class="post-meta__tags" href="/tags/SDK-IDF/">SDK-IDF</a><a class="post-meta__tags" href="/tags/%E6%B6%B2%E6%99%B6%E5%B1%8F/">液晶屏</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/gh/overtrue/share.js@master/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/1109857756.html"><img class="prev-cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">ESP-IDF之头文件问题 - ESP-IDF - 乐鑫 - ESP8266 - 物联网 - ESP32 - Components - 头文件找不到 - CmakeLists</div></div></a></div><div class="next-post pull-right"><a href="/posts/4122746189.html"><img class="next-cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">LVGL启动过程</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/2870405859.html" title="ESP32开发SDK-IDF环境搭建(Ubuntu)"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-03</div><div class="title">ESP32开发SDK-IDF环境搭建(Ubuntu)</div></div></a></div><div><a href="/posts/2527818842.html" title="ESP32环境(Ubuntu) 问题集锦"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-27</div><div class="title">ESP32环境(Ubuntu) 问题集锦</div></div></a></div><div><a href="/posts/2149552820.html" title="ESP32环境搭建和LGVL驱动"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-07-17</div><div class="title">ESP32环境搭建和LGVL驱动</div></div></a></div><div><a href="/posts/442091668.html" title="通过HOMEKIT让ESP8266控制继电器"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-25</div><div class="title">通过HOMEKIT让ESP8266控制继电器</div></div></a></div><div><a href="/posts/3713584928.html" title="Ubuntu烧录下载时找不到USB0报错"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-28</div><div class="title">Ubuntu烧录下载时找不到USB0报错</div></div></a></div><div><a href="/posts/2449930636.html" title="ESP8266及ESP32固件生成及烧录方法"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-23</div><div class="title">ESP8266及ESP32固件生成及烧录方法</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">ZhaoYichen</div><div class="author-info__description">直到这一刻微笑着说话为止，我至少留下了一公升眼泪</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">220</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">370</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">139</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/zml3589110"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/zml3589110" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:zhaominglong_life@outlook.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ST7789%E6%B6%B2%E6%99%B6%E5%B1%8F%E5%BC%80%E5%8F%91"><span class="toc-number">1.</span> <span class="toc-text">ST7789液晶屏开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9D%E6%AC%A1%E5%B0%9D%E8%AF%95"><span class="toc-number">1.2.</span> <span class="toc-text">初次尝试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B9%B6%E6%B2%A1%E6%9C%89%E6%89%BE%E5%88%B0%E9%A9%B1%E5%8A%A8"><span class="toc-number">1.3.</span> <span class="toc-text">并没有找到驱动</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9D%E6%AC%A1%E5%B0%9D%E8%AF%95%E5%AE%89%E8%A3%85SPI-LCD-IO-%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F"><span class="toc-number">1.4.</span> <span class="toc-text">初次尝试安装SPI LCD IO 驱动程序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9D%E6%AC%A1%E4%BD%BF%E7%94%A8%E6%8E%A7%E5%88%B6LCD-IO%E7%9A%84API"><span class="toc-number">1.5.</span> <span class="toc-text">初次使用控制LCD IO的API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E6%AC%A1%E5%B0%9D%E8%AF%95"><span class="toc-number">1.6.</span> <span class="toc-text">二次尝试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%80%E7%BB%88%E5%B0%9D%E8%AF%95"><span class="toc-number">1.7.</span> <span class="toc-text">最终尝试</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%AD%A3%E7%89%87"><span class="toc-number">2.</span> <span class="toc-text">正片</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AESPI%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="toc-number">2.1.</span> <span class="toc-text">配置SPI控制器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E5%86%99LCD%E5%B1%8F%E5%B9%95%E5%88%9D%E5%A7%8B%E5%8C%96%E5%87%BD%E6%95%B0"><span class="toc-number">2.2.</span> <span class="toc-text">编写LCD屏幕初始化函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#LCD-Init"><span class="toc-number">2.2.1.</span> <span class="toc-text">LCD_Init</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LCD-WR-GER"><span class="toc-number">2.2.2.</span> <span class="toc-text">LCD_WR_GER</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#LCD-WR-DATA8"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">LCD_WR_DATA8</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lcd-cmd"><span class="toc-number">2.2.2.2.</span> <span class="toc-text">lcd_cmd</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LCD-data-x"><span class="toc-number">2.2.2.3.</span> <span class="toc-text">LCD_data_x</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LCD-Init-h"><span class="toc-number">2.2.2.4.</span> <span class="toc-text">LCD_Init.h</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E-ESP32-%E7%9A%84-LCD-%E6%A8%A1%E5%9D%97%EF%BC%88ST7789%EF%BC%89%E5%BC%80%E5%8F%91"><span class="toc-number">2.3.</span> <span class="toc-text">基于 ESP32 的 LCD 模块（ST7789）开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E5%91%BD%E4%BB%A4"><span class="toc-number">2.3.1.</span> <span class="toc-text">初始化命令</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E9%93%BE%E6%8E%A5%EF%BC%88%E4%BE%B5%E5%88%A0%EF%BC%89"><span class="toc-number">3.</span> <span class="toc-text">相关链接（侵删）</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/2299103280.html" title="LVGL组件 lv_bar"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="LVGL组件 lv_bar"/></a><div class="content"><a class="title" href="/posts/2299103280.html" title="LVGL组件 lv_bar">LVGL组件 lv_bar</a><time datetime="2024-07-18T03:30:20.000Z" title="发表于 2024-07-18 11:30:20">2024-07-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/4122746189.html" title="LVGL启动过程"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="LVGL启动过程"/></a><div class="content"><a class="title" href="/posts/4122746189.html" title="LVGL启动过程">LVGL启动过程</a><time datetime="2024-07-18T03:06:20.000Z" title="发表于 2024-07-18 11:06:20">2024-07-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/1827825660.html" title="ESP32使用SPI总线驱动LCD"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ESP32使用SPI总线驱动LCD"/></a><div class="content"><a class="title" href="/posts/1827825660.html" title="ESP32使用SPI总线驱动LCD">ESP32使用SPI总线驱动LCD</a><time datetime="2024-07-18T02:34:20.000Z" title="发表于 2024-07-18 10:34:20">2024-07-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/1109857756.html" title="ESP-IDF之头文件问题 - ESP-IDF - 乐鑫 - ESP8266 - 物联网 - ESP32 - Components - 头文件找不到 - CmakeLists"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ESP-IDF之头文件问题 - ESP-IDF - 乐鑫 - ESP8266 - 物联网 - ESP32 - Components - 头文件找不到 - CmakeLists"/></a><div class="content"><a class="title" href="/posts/1109857756.html" title="ESP-IDF之头文件问题 - ESP-IDF - 乐鑫 - ESP8266 - 物联网 - ESP32 - Components - 头文件找不到 - CmakeLists">ESP-IDF之头文件问题 - ESP-IDF - 乐鑫 - ESP8266 - 物联网 - ESP32 - Components - 头文件找不到 - CmakeLists</a><time datetime="2024-07-18T01:22:20.000Z" title="发表于 2024-07-18 09:22:20">2024-07-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/2149552820.html" title="ESP32环境搭建和LGVL驱动"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ESP32环境搭建和LGVL驱动"/></a><div class="content"><a class="title" href="/posts/2149552820.html" title="ESP32环境搭建和LGVL驱动">ESP32环境搭建和LGVL驱动</a><time datetime="2024-07-17T12:04:20.000Z" title="发表于 2024-07-17 20:04:20">2024-07-17</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By ZhaoYichen</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a href="icp连接"><img class="icp-icon" src="icp图片"><span>备案号：xxxxxx</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script></div><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body></html>