<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>小白自制Linux开发板 | 赵逸尘个人博客</title><meta name="keywords" content="全志,F1C200S,开发板,Linux"><meta name="author" content="ZhaoYichen"><meta name="copyright" content="ZhaoYichen"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="小白自制Linux开发板">
<meta property="og:type" content="article">
<meta property="og:title" content="小白自制Linux开发板">
<meta property="og:url" content="https://zml3589110.github.io/posts/3433483963.html">
<meta property="og:site_name" content="赵逸尘个人博客">
<meta property="og:description" content="小白自制Linux开发板">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg">
<meta property="article:published_time" content="2025-09-05T12:43:20.000Z">
<meta property="article:modified_time" content="2025-09-10T12:50:20.421Z">
<meta property="article:author" content="ZhaoYichen">
<meta property="article:tag" content="全志">
<meta property="article:tag" content="F1C200S">
<meta property="article:tag" content="开发板">
<meta property="article:tag" content="Linux">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><link rel="shortcut icon" href="/img/favicon_1.png"><link rel="canonical" href="https://zml3589110.github.io/posts/3433483963"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: ZhaoYichen","link":"链接: ","source":"来源: 赵逸尘个人博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '小白自制Linux开发板',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-09-10 20:50:20'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.1.1"><link rel="alternate" href="/atom.xml" title="赵逸尘个人博客" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">369</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">527</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">215</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/random.html"><i class="fa-fw fas fa-random"></i><span> Random | 随机文章</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">赵逸尘个人博客</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/random.html"><i class="fa-fw fas fa-random"></i><span> Random | 随机文章</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">小白自制Linux开发板</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-09-05T12:43:20.000Z" title="发表于 2025-09-05 20:43:20">2025-09-05</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-09-10T12:50:20.421Z" title="更新于 2025-09-10 20:50:20">2025-09-10</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Linux/">Linux</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/F1C200S/">F1C200S</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">11.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>41分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="小白自制Linux开发板"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="一-瞎抄原理图与乱画PCB"><a href="#一-瞎抄原理图与乱画PCB" class="headerlink" title="一. 瞎抄原理图与乱画PCB"></a>一. 瞎抄原理图与乱画PCB</h1><p>因为墨云是基于高中物理水平的电路知识来学习、而且此前也就玩过树莓派、Esp8266之类的开发板，水平基础趋近于零，所以在写这个系列的时候抱着记录的心态、还望不足之处还望大佬们指正。</p>
<p>《论语》说：见贤思齐焉。所以现在墨云又开始瞎折腾了</p>
<p>为啥突然想做嵌入式开发呢，因为看见了下面两位牛人</p>
<p>【稚晖君】</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av65365123/">https://www.bilibili.com/video/av65365123/</a></p>
<p>【在名片上运行的Business Card Linux】</p>
<p><a target="_blank" rel="noopener" href="https://www.thirtythreeforty.net/posts/2019/12/my-business-card-runs-linux/"> https://www.thirtythreeforty.net/posts/2019/12/my-business-card-runs-linux/</a></p>
<p>于是躁动的心开始蠢蠢欲动。</p>
<p>先定个小目标：</p>
<p>　　<em>设计一个没啥作用，但是可以运行Linux的小板。</em></p>
<p>样子大概长这样：</p>
<p>　　<a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202106/483434-20210609081210227-1578860150.png"><img src="/posts/undefined/483434-20210609081210227-1578860150.png" class="" title="img"></a></p>
<p> 所以有了初步想法，那开始吧</p>
<h2 id="1-工具与芯片说明"><a href="#1-工具与芯片说明" class="headerlink" title="1. 工具与芯片说明#"></a>1. 工具与芯片说明<a target="_blank" rel="noopener" href="https://www.cnblogs.com/twzy/p/14714651.html#1.-%E5%B7%A5%E5%85%B7%E4%B8%8E%E8%8A%AF%E7%89%87%E8%AF%B4%E6%98%8E">#</a></h2><p><strong>立创EDA</strong>：电路图与PCB设计工具，本次硬件部分设计全部使用立创EDA完成</p>
<p><strong>F1C100s</strong> ：全志的一款基于Arm的小型Soc，自带32MB的内存，其升级版F1C200s为64MB内存，因为其极其便宜(当然最近因为芯片涨价影响)，可以运行Linux，最典型的基于该芯片的荔枝派开发板。</p>
<p><strong>CH340E</strong>：USB转串口通信芯片，是作为与外界通信的唯一接口 、CH340E个头小、外围电路少，使用简单。</p>
<p><strong>原理图</strong>：先后参考了(baipiao)了Licheepi Nano、Business LinuxCard、LiShanwenGit(<a target="_blank" rel="noopener" href="https://www.oshwhub.com/LSW12315)%E7%AB%8B%E5%88%9B%E5%BC%80%E6%BA%90%E5%B9%BF%E5%9C%BA%E7%9A%84%E4%B8%80%E7%B3%BB%E5%88%97%E9%A1%B9%E7%9B%AE">https://www.oshwhub.com/LSW12315)立创开源广场的一系列项目</a></p>
<h2 id="2-原理图说明"><a href="#2-原理图说明" class="headerlink" title="2.原理图说明#"></a>2.原理图说明<a target="_blank" rel="noopener" href="https://www.cnblogs.com/twzy/p/14714651.html#2.%E5%8E%9F%E7%90%86%E5%9B%BE%E8%AF%B4%E6%98%8E">#</a></h2><p> <strong>电源管理</strong></p>
<p> 电源部分使用USB方式供电，输入电压为5V，这里供电部分和串口电路共用相同USB端口。</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202106/483434-20210607100226272-904592004.png"><img src="/posts/undefined/483434-20210607100226272-904592004.png" class="" title="img"></a></p>
<p>  通过查询F1c100s数据手册：</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202106/483434-20210607100558506-389190797.png"><img src="/posts/undefined/483434-20210607100558506-389190797.png" class="" title="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202106/483434-20210607100617030-1539276821.png"><img src="/posts/undefined/483434-20210607100617030-1539276821.png" class="" title="img"></a></p>
<p> 通过综合分析，我们可以大概把电源分为4类</p>
<p>  Vdd-Core：1.1V</p>
<p>  Vcc-Dram：2.5V</p>
<p>  AVCC : 3.0V</p>
<p>  UVCC&#x2F;VCC-IO&#x2F;TV-AVCC&#x2F;TTL：3.3</p>
<p>  这里主要使用 SY8088AAC 同步降压DC-DC稳压器，为SOT32-5的封装方式，通过使用外围电阻调整输出电压。</p>
<p>  公式为：</p>
<p>​      <strong>Vout &#x3D; 0.6 * (&#96;1+Ra&#x2F;Rb)</strong> </p>
<p>而AVCC使用XC6206P302MR-SOT23的封装方式，输入5V 输出为3.0V</p>
<p>因为 AVCC为模拟电源电压，为了避免引入电源干扰，通常需要把把模拟电路与数字电路分开隔离开(这个地方解释可能不对，欢迎指正)。</p>
<p>电源部分的原理图如下：</p>
<p> <a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202105/483434-20210518075511811-1722536141.png"><img src="/posts/undefined/483434-20210518075511811-1722536141.png" class="" title="img"></a></p>
<p>电压输入输出端都使用滤波电容进行处理，使用还要接入2.2uH的功率电感，注意一定要用功率电感，电流要求可以达到1A以及以上的才行</p>
<p>这个板子使用0805的功率电感，建议最好使用CD32类型的绕线功率电感。</p>
<p><strong>核心原理图</strong></p>
<p>对于核心部分的原理图如下，因为本次电路设计主要以验证为主，所以并没有做太多的外设电路。</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202105/483434-20210518075644565-3556161.png"><img src="/posts/undefined/483434-20210518075644565-3556161.png" class="" title="img"></a></p>
<p>除了常规的核心、外围、DRAM工单引脚，核心部分还引出了</p>
<p> \1. TF卡引脚，作为本板子唯一的系统加载电路，这是必须的</p>
<p> 2.晶振，使用规格为24Mhz的有源晶振、加两个15pf的负载电容</p>
<p> 3.串口调试 作为板子与外界唯一交互的通道，这个也是必须的，然而在做这个成功的给自己挖坑了。</p>
<p> 4.LED灯，这是这个板子唯一的外设，也是用来学习驱动开发的第一步。</p>
<p> 5.dram_vref、Var1、Var2 这是必须要接的、外围电路，我也不知道的干啥的 <del>_</del>…</p>
<p> 6.USB OTG 也是作为一个通信接口来使用，通过这个接口可以为板载Flash下载程序，但是因为本板没有做Flash，所以目前唯一的作用就是放到验证fel是否可以调通。</p>
<p> 7.复位按钮</p>
<p><strong>挖坑点</strong></p>
<p>一直以来认为发光二极管也是二极管，所以就有下面的设计(乱画)，于是后来感觉板子没问题，但是就是串口死活不显示数据、在众多大佬的帮助下，才发现了这个其妙(naocan)</p>
<p>的接线方法，于是将两个发光二极管位置放了两个0欧的电阻，一下子就成功调通了。</p>
<p> <a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202105/483434-20210518081301718-1938463553.png"><img src="/posts/undefined/483434-20210518081301718-1938463553.png" class="" title="img"></a></p>
<p>对于芯片电源输入端的滤波电容与Dram_vref接线如下：</p>
<p>对于滤波电容简单的说法就是，对于供电端的电压，因为电路设计或者外界干扰等等，其实不是完美的电压，总会存在高频或是低频的噪声，而用小容量的电容就可以降低这些干扰。</p>
<p>常规的容值就是 10uf 、1uf、100nf</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202105/483434-20210518075706884-1416748722.png"><img src="/posts/undefined/483434-20210518075706884-1416748722.png" class="" title="img"></a></p>
<p><strong>通信电路</strong></p>
<p>我们在核心原理图中看到了引出的串口线路，而串口的接口如下：</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202106/483434-20210608075946061-1759039430.png"><img src="/posts/undefined/483434-20210608075946061-1759039430.png" class="" title="img"></a> <a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202106/483434-20210608080015029-894589865.png"><img src="/posts/undefined/483434-20210608080015029-894589865.png" class="" title="img"></a></p>
<p>显然在你看看你超博的笔记本机身，并没有发现这个接口，偶尔还有一些老的笔记本上面可以看到类似的接口，对不起——那是显示屏的VGA接口。</p>
<p>那我们如何使用串口传输的信息呢，我们需要一个USB转串口的芯片，usb转串口的芯片很多，这里选择 CH340E 这个型号，因为其很小，接线也方便。</p>
<p>原理图如下：</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202105/483434-20210518075726899-441537012.png"><img src="/posts/undefined/483434-20210518075726899-441537012.png" class="" title="img"></a></p>
<p>前面提到，这个板子共用了电源与TTL共用了一套设计，也就是是说USB线插上就可以启动小板，并且开始进入串口调试。</p>
<p>原理图中的U5是一个自恢复保险丝。</p>
<p><em>这里需要注意一下：</em></p>
<p> 根据CH340E官方的原理图，当VCC接入5V的时候，V3 需要接一个100nf的电容，但是此处在V3直接接入5V，也可以工作。</p>
<p> 实际使用的时候最好不要这样做。</p>
<p><strong>TF卡接口</strong></p>
<p>和电脑主机在BIOS选择启动方式一样， F1C100s 支持多种方式的系统加载机制比如通过SPI接口加载Flash芯片中的镜像，或者通过TF卡接口加载镜像。</p>
<p>这里使用TF卡作为启动源，这样做是因为</p>
<p> 1.TF卡容量可以自己控制。</p>
<p> 2.系统烧写调试方便</p>
<p>这部分电路相对简单，原理图如下：</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202105/483434-20210518075745633-24558076.png"><img src="/posts/undefined/483434-20210518075745633-24558076.png" class="" title="img"></a></p>
<p><strong>OTG 与唯一的外设LED灯</strong></p>
<p> <a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202105/483434-20210518075809957-1231071962.png"><img src="/posts/undefined/483434-20210518075809957-1231071962.png" class="" title="img"></a></p>
<h2 id="3-PCB绘制"><a href="#3-PCB绘制" class="headerlink" title="3.PCB绘制#"></a>3.PCB绘制<a target="_blank" rel="noopener" href="https://www.cnblogs.com/twzy/p/14714651.html#3.pcb%E7%BB%98%E5%88%B6">#</a></h2><p> PCB尺寸为42mm*29mm ，可以说非常小了，为了便于焊接，所有容阻都是用0805的封装方式</p>
<p> 电源走线为14mil ，信号线为8mil</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202105/483434-20210518075900597-2044589685.png"><img src="/posts/undefined/483434-20210518075900597-2044589685.png" class="" title="img"></a></p>
<h2 id="4-PCB焊接"><a href="#4-PCB焊接" class="headerlink" title="4.PCB焊接#"></a>4.PCB焊接<a target="_blank" rel="noopener" href="https://www.cnblogs.com/twzy/p/14714651.html#4.pcb%E7%84%8A%E6%8E%A5">#</a></h2><p> 焊接PCB是一项手艺活，尤其是QFN方式封装的F1C100s 更是难到发指，还好借助焊台和热风枪，完美的完成了焊接，当然放大镜、洗板水是不可缺少的。</p>
<p> 并且因为板子时长需要在手上把玩（盘PCB）。所以选择了无铅稀浆进行焊接。</p>
<p>效果如下：</p>
<p> <a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202105/483434-20210518080628282-1076112978.png"><img src="/posts/undefined/483434-20210518080628282-1076112978.png" class="" title="img"></a><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202105/483434-20210518080325298-910819870.png"><img src="/posts/undefined/483434-20210518080325298-910819870.png" class="" title="img"></a></p>
<p>成功运行Linux，</p>
<p>因为还没开始着手做Linux移植，暂时使用LicheePi 的镜像，下一节开始做Linux的移植。</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202105/483434-20210518080244837-276955395.png"><img src="/posts/undefined/483434-20210518080244837-276955395.png" class="" title="img"></a></p>
<h2 id="5-后记-https-www-cnblogs-com-twzy-p-14714651-html-5-后记"><a href="#5-后记-https-www-cnblogs-com-twzy-p-14714651-html-5-后记" class="headerlink" title="5. 后记[#](https://www.cnblogs.com/twzy/p/14714651.html# 5.-后记)"></a>5. 后记[#](<a target="_blank" rel="noopener" href="https://www.cnblogs.com/twzy/p/14714651.html#">https://www.cnblogs.com/twzy/p/14714651.html#</a> 5.-后记)</h2><p>事实上世界上从来没有所谓轻易的成功，对于初次玩PCB的小白更是如此，现在这个小板能成功也是经历三四个月，五六次打板才成功的。以下是早期的趟雷PCB场景与先烈。 (右下角为成功的小板)</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202105/483434-20210518080712817-696267996.png"><img src="/posts/undefined/483434-20210518080712817-696267996.png" class="" title="img"></a></p>
<p> <a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202105/483434-20210518080742813-715067385.png"><img src="/posts/undefined/483434-20210518080742813-715067385.png" class="" title="img"></a></p>
<h3 id="硬件资料包：-https-www-cnblogs-com-twzy-p-14714651-html-硬件资料包："><a href="#硬件资料包：-https-www-cnblogs-com-twzy-p-14714651-html-硬件资料包：" class="headerlink" title="硬件资料包：[#](https://www.cnblogs.com/twzy/p/14714651.html# 硬件资料包：)"></a>硬件资料包：[#](<a target="_blank" rel="noopener" href="https://www.cnblogs.com/twzy/p/14714651.html#">https://www.cnblogs.com/twzy/p/14714651.html#</a> 硬件资料包：)</h3><p><a target="_blank" rel="noopener" href="https://files.cnblogs.com/files/twzy/LinuxNano%E5%B7%A5%E7%A8%8B%E4%B8%8E%E5%8E%9F%E7%90%86%E5%9B%BE-%E5%A2%A8%E4%BA%91.zip"> 下载</a></p>
<h1 id="二-u-boot移植"><a href="#二-u-boot移植" class="headerlink" title="二. u-boot移植"></a>二. u-boot移植</h1><p>我们都知道，PC在启动的时候，首先是进入BIOS，再根据BIOS中配置信息引导后续的启动操作系统，比如配置Windows启动。</p>
<p>而对于嵌入式linux中，并没有BIOS，这时候就需要一种类似引导程序来处理。于是就有了BootLoader。</p>
<p>BootLoader是一段小程序，可以把它想象成PC机linux上的GRUB&#x2F;LILO引导程序，可以直接从flash或TF卡中运行，来装载内核。它可以初始化硬件设备，从而将系统的软硬件环境带到一个合适的状态，以便为最终调用操作系统做好准备。</p>
<h2 id="1-嵌入式开发板的启动过程"><a href="#1-嵌入式开发板的启动过程" class="headerlink" title="1. 嵌入式开发板的启动过程#"></a>1. 嵌入式开发板的启动过程<a target="_blank" rel="noopener" href="https://www.cnblogs.com/twzy/p/14865952.html#1.-%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91%E6%9D%BF%E7%9A%84%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B">#</a></h2><p>一个嵌入式系统从软件角度来看分为三个层次：</p>
<ul>
<li>引导加载程序</li>
</ul>
<p>​      包括固化在芯片中的boot程序（可选）和BootLoader两大部分，对于固化的boot程序。主要是芯片通过外围电路连接的实际情况选择读入程序的位置，比如：通过TF卡或是SPI以及其他方式启动，至于优先顺序这就要具体看芯片的数据手册，个人没做过具体测试。</p>
<ul>
<li>linux内核</li>
</ul>
<p>​     特定于嵌入式平台的定制内核</p>
<ul>
<li>文件系统</li>
</ul>
<p>​     包括了系统命令和应用程序</p>
<table>
<thead>
<tr>
<th>BootLoader</th>
<th>Boot Parameters</th>
<th>Kernel</th>
<th>Root Filesystem</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p><strong>BootLoader</strong>启动过程可分为单阶段和多阶段(stage1、stage2),其中stage1完成初始化硬件，如CPU寄存器、内存控制器，为stage2准备内存空间。一般stage1是可以直接在nor flash中运行的，并将stage2复制到内存RAM中，设置堆栈，然后跳转到stage2(从这也可以看出stage2是在RAM中运行的，与stage1不同)</p>
<p><strong>Boot Parameters</strong> 顾名思义，就是配置了要启动内核的参数，包含要加载系统内核相关文件的位置，要加载到内存中的位置，定位到文件系统的位置，相关输入输出的呈现等一系列参数。</p>
<p><strong>kernel</strong> 在存放在bootloader之后，对于SoC来说，代码都需要在RAM中运行，这里与MCU不一样的地方就是引入了MMU（内存管理单元）。对于MCU而言，由于其执行速度低，因此运行代码都在ROM中直接运行，而对于Flash而言，其读取速度远不及RAM的速度，因此对于运行速度非常快的SoC而言，所有的代码都需要在RAM中运行。但是这里有一个问题，RAM掉电数据将会丢失，故代码保存不可能放在RAM中，当前所有的嵌入式设备而言，代码保存都是放在ROM中，因此在SoC中运行代码需要将代码搬运到RAM中然后再执行。</p>
<p><strong>Root Filesystem</strong> 由于其执行过程需要对ROM进行读写操作，因此可以不用搬运到RAM中，但是实际过程中内核启动后会产生一个虚拟的文件系统，该文件系统是挂在根文件系统的关键所在，这里不详细讲解。整体来说，大致的过程为，嵌入式设备上电后将执行bootloader，对硬件进行硬件和堆栈初始化，然后搬运内核到RAM中并启动内核，紧接着挂载根文件系统。</p>
<h2 id="2-环境配置与参考项目"><a href="#2-环境配置与参考项目" class="headerlink" title="2. 环境配置与参考项目#"></a>2. 环境配置与参考项目<a target="_blank" rel="noopener" href="https://www.cnblogs.com/twzy/p/14865952.html#2.-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%8F%82%E8%80%83%E9%A1%B9%E7%9B%AE">#</a></h2><p>系统：Ubuntu 16</p>
<p>编辑器：VSCode</p>
<p>参考项目：Lichee-Pi Nano </p>
<p>地址：<a target="_blank" rel="noopener" href="https://wiki.sipeed.com/soft/Lichee/zh/Nano-Doc-Backup/index.html">https://wiki.sipeed.com/soft/Lichee/zh/Nano-Doc-Backup/index.html</a></p>
<p> <a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202108/483434-20210826080525817-1455821238.png"><img src="/posts/undefined/483434-20210826080525817-1455821238.png" class="" title="img"></a></p>
<p>Lichee-Pi Nano</p>
<p>需要注意的是一定要选择Nano版本，因为我们开发板使用的主控芯片和Nano的主控是一致的，所以后续我们要编译U-boot，内核都可以参考(bai piao)这里面的配置。</p>
<p>主控芯片：F1c100s&#x2F;F1c200s，100s内置32MB DDR1内存，200s内置64MB DDR1内存，200s贵一点，他们都是QFN88封装。</p>
<p>ARM926ejs内核，主频默认408MHz，据了解做产品出货的一般在600M左右。</p>
<p>带有100M的SPI接口2个，SDIO接口1个，USB OTG接口，还有CSI摄像头接口，LCD RGB显示屏接口，音频接口，I2C I2S UART PWM等等。</p>
<p>还有就是他们不支持硬件浮点，所以浮点运算使用软浮点方式。</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202108/483434-20210826080450826-950498006.png"><img src="/posts/undefined/483434-20210826080450826-950498006.png" class="" title="img"></a></p>
<p> F1c100s&#x2F;F1c200s芯片功能</p>
<h2 id="3-交叉编译器"><a href="#3-交叉编译器" class="headerlink" title="3.交叉编译器#"></a>3.交叉编译器<a target="_blank" rel="noopener" href="https://www.cnblogs.com/twzy/p/14865952.html#3.%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E5%99%A8">#</a></h2><p>  我们通过PC版的Linux自带的gcc编译的程序只能在当前系统架构下的cpu架构(x86)下运行，如果我们想要编写的程序在嵌入式Linux下运行，那么就需要用到对应的编译器。</p>
<p>  我们做的开发板主控芯片F1C200S，内核为ARM9，其架构使用的是ARMv5架构，所以我们也要选用对应的编译器，同样，这样的编译器很多，这里我们使用最常用的arm-linux-gnueabi- ，因为交叉编译器F1C200S必须高于6.0版本，这里我们使用7.2版本</p>
<p>  <a target="_blank" rel="noopener" href="https://releases.linaro.org/components/toolchain/binaries/7.2-2017.11/arm-linux-gnueabi/gcc-linaro-7.2.1-2017.11-x86_64_arm-linux-gnueabi.tar.xz"> 点击下载</a></p>
<p>  <em>下载较慢时使用下载工具</em></p>
<p>下载完成后解压文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -vxjf gcc-linaro-7.2.1-2017.11-x86_64_arm-linux-gnueabi.tar.xz</span><br></pre></td></tr></table></figure>

<p>然后在&#x2F;usr&#x2F;local目录下新建arm-linux-gcc目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir &#x2F;usr&#x2F;local&#x2F;arm-linux-gcc</span><br></pre></td></tr></table></figure>

<p>进入解压目录下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd gcc-linaro-7.2.1-2017.11-x86_64_arm-linux-gnueabi&#x2F;</span><br></pre></td></tr></table></figure>

<p>将该目录下的所有文件复制到新建的目录下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp -rd * &#x2F;usr&#x2F;local&#x2F;arm-linux-gcc&#x2F;</span><br></pre></td></tr></table></figure>

<p>最后需要添加该工具链的环境变量使其可以在任何目录下执行，打开&#x2F;etc&#x2F;profile文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure>

<p>在文件末尾添加以下内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PATH&#x3D;$PATH:&#x2F;usr&#x2F;local&#x2F;arm-linux-gcc&#x2F;bin</span><br></pre></td></tr></table></figure>

<p>添加完毕，使路径生效</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure>

<p>接下来在终端输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arm-linux-</span><br></pre></td></tr></table></figure>

<p>然后连按两次Tab键，如图在表示成功：</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202108/483434-20210823161114895-675144161.png"><img src="/posts/undefined/483434-20210823161114895-675144161.png" class="" title="img"></a></p>
<p>如果没有出现，则进行下面操作，安装必要的动态链接库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install lib32ncurses5 lib32z1</span><br></pre></td></tr></table></figure>

<p>至此，我们完成了编译工具的配置。</p>
<h2 id="4-编译U-boot"><a href="#4-编译U-boot" class="headerlink" title="4. 编译U-boot#"></a>4. 编译U-boot<a target="_blank" rel="noopener" href="https://www.cnblogs.com/twzy/p/14865952.html#4.-%E7%BC%96%E8%AF%91u-boot">#</a></h2><p> 当Arm开发板上电以后第一个要加载到内存并运行的程序就是**BootLoader，**BootLoader****的同类型程序很多，如U-boot、X-boot、Rt-Thread，这里我们依然选中最常用的U-boot作为目标(因为其他的我也不会呀)，</p>
<p> 最新版本的uboot几乎包含当前主流的SoC芯片，前面提到本开发板使用的芯片和licheePI nano相同，大部分硬件也是兼容的，为了快速移植该部分，这里采用licheePI nano的u-boot来进行移植。在终端输入如下命令克隆u-boot：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;Lichee-Pi&#x2F;u-boot.git -b nano-v2018.01</span><br></pre></td></tr></table></figure>

<p>克隆完毕文件会保存在当前目录下，进入该目录，*<br>*</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd u-boot</span><br></pre></td></tr></table></figure>

<p>在该文件夹下有很多分支，我们可以查看所有分支，使用如下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -a</span><br></pre></td></tr></table></figure>

<p>现在我们使用的是nano开发板，所以将当前分支切换到nano分支，命令如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout nano-v2018.01u-boot</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202109/483434-20210928150820570-1873390261.png"><img src="/posts/undefined/483434-20210928150820570-1873390261.png" class="" title="img"></a></p>
<p> 切换到Nano分支</p>
<p>默认的没有指定交叉工具链和架构，因此在编译之前需要指定交叉工具链和芯片架构，u-boot的交叉编译器在u-boot 的根目录下中的<strong>Makefile</strong>文件中定义了。打开文件找到<strong>CROSS_COMPILE</strong>变量，修改为如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ARCH&#x3D;arm</span><br><span class="line">CROSS_COMPILE&#x3D;arm-linux-gnueabi-</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202109/483434-20210928151000818-1228538185.png"><img src="/posts/undefined/483434-20210928151000818-1228538185.png" class="" title="img"></a></p>
<p> 配制交叉编译环境</p>
<p>这样我们就能使用我们指定的编译器来编译u-boot了。</p>
<p>在u-boot项目的config目录下存在对多种板子的配置描述文件，由于每个板子的外设不同，因此编译之前必须要对u-boot进行配置。然而配置是一件比较繁琐的事情，特别是像u-boot这种比较复杂的项目而言，初学者几乎无法完成。幸运的是对于大部分开发板而言，config目录下有其配置好的默认配置文件。进入config目录中，然后执行ls查看当前所有的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd config</span><br><span class="line">ls</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202109/483434-20210928151205314-374311839.png"><img src="/posts/undefined/483434-20210928151205314-374311839.png" class="" title="img"></a></p>
<p> 查看配制文件</p>
<p>找到<strong>licheepi_nano_defconfig</strong> 和 <strong>licheepi_nano_spiflash_defconfig</strong>，前者表示为TF卡启动，后者表示从SPI 设备启动，因为我们做的小板只有从TF卡启动，所以我们需要使用 <strong>licheepi_nano_defconfig</strong> 。</p>
<p>现在回到上级目录，然后执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make licheepi_nano_defconfig</span><br></pre></td></tr></table></figure>

<p>这样我们把<strong>licheepi_nano_defconfig</strong> 作为默认配置项。</p>
<p>接下来我们就可以用图形界面进行配置了，执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make menuconfig</span><br></pre></td></tr></table></figure>

<p>此时出现图形配置选项，如下图所示</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202109/483434-20210928151406633-1920865408.png"><img src="/posts/undefined/483434-20210928151406633-1920865408.png" class="" title="img"></a></p>
<p> u-boot Menuconfig配制，注意红框中的配置，我们后续要用到。</p>
<p>至此我们的u-boot环境配置就完成了，但是我们还有个问题要解决：<strong>如何让u-boot引导系统</strong></p>
<p>我们在PC端安装Windows系统的时候往往需要选择启动顺序，比如需要优先通过光驱或u盘启动等。</p>
<p>同样在u-boot中也需要这样的配置，当然u-boot比PC配置稍微复杂一丢丢。我们前面提到Linux嵌入式系统结构分布中有个Boot Parameters 部分，这部分就是做引导配置的，那怎么配置呢，总体来说可以分为两部分：</p>
<ol>
<li>bootcmd，主要用于描述控制Linux内核文件以及其他描述文件加载到内存中位置以及启动Linux内核系统等</li>
<li>bootargs，用于配制文件系统、串口信息等。</li>
</ol>
<p><strong>bootcmd</strong></p>
<p>在最开始提到过，内核一般不在flash中运行，这样就需要将内核搬运到内存中，这个过程需要u-boot来完成。对于mmc (TF卡)而言，在u-boot有专门的命令<strong>load mmc</strong>，该命令可以将mmc中的代码从flash搬运到指定的地址处。</p>
<p>当u-boot中环境变量bootdelay计数到0时，此时uboot就会开始执行bootcmd中的命令。</p>
<p>bootdelay这个环境变量是一个计数器，当u-boot主体运行完毕后，此时bootdelay该变量的值将会开始递减，递减时间为1s，当递减到0时，此时u-boot将会跳转到bootcmd处开始执行bootcmd命令，（你可以简单理解为PC启动后有一两秒时间等待，你可以可以通过F8或Enter键打断进入Bios设置的过程，这个等待时间就由u-boot中的bootdelay来控制）。</p>
<p>下面我们需要记住这句指令，这就是我们当前制作的开发板需要用到的bootcmd全部内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load mmc 0:1 0x80008000 zImage;load mmc 0:1 0x80c08000 suniv-f1c100s-licheepi-nano.dtb;bootz 0x80008000 - 0x80c08000;</span><br></pre></td></tr></table></figure>

<p>如果你需要详细了解这句话那就接着往下看，如果不需要则可以跳到 下面的u-boot参数配置环节</p>
<p>对于上面命令，我们根据分号拆分为3部分:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1&gt; load mmc 0:1 0x80008000 zImage;</span><br><span class="line">2&gt; load mmc 0:1 0x80c08000 suniv-f1c100s-licheepi-nano.dtb;</span><br><span class="line">3&gt; bootz 0x80008000 - 0x80c08000;</span><br></pre></td></tr></table></figure>

<p>其中两个 load mmc 命令、一个bootz 命令。</p>
<p>先看第一条：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load mmc 0:1 0x80008000 zImage</span><br></pre></td></tr></table></figure>

<p>load mmc有三个参数：第一个参数是mmc(TF卡)分区，第二个参数是内存中目标地址，第三个参数是源文件。</p>
<p>即上面的命令意思是<strong>将mmc的0:1 分区中的zImage复制到内存中的0x80008000地址处。</strong>这里的zimage就是Linux内核，后续会提到该文件编译，0:1这个可以这样理解0表示TF卡(TF卡属于mmc存储器的一种)，1这表示TF卡的第一个分区(boot分区)后面会提到。</p>
<p>而对于内存位置 <strong>0x80008000</strong> 地址位置，将其理解为默认值就行了。这样完成了zImage的加载。</p>
<p>下面分析第二条命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load mmc 0:1 0x80c08000 suniv-f1c100s-licheepi-nano.dtb</span><br></pre></td></tr></table></figure>

<p>有了上面的加载zImage的说明，可以很轻松的理解上面的命令意思是将mmc的0:1分区中的suniv-f1c100s-licheepi-nano.dtb文件加载到内存中的0x80c08000地址处。对于<strong>suniv-f1c100s-licheepi-nano.dtb</strong> 这个文件，叫做设备树文件，简单来说就是当前开发板上面所有外设备描述文件，这部分将会在后续内核编译部分进行详细说明。</p>
<p>对于第三条命令： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bootz 0x80008000 - 0x80c08000</span><br></pre></td></tr></table></figure>

<p>的意思是告诉内核镜像的起始地址为0x80008000，加载的设备树地址为0x80c08000。这里是告诉cpu从这里开始启动Linux， bootz命令的格式是：bootz空格0x80008000空格-空格0x80c08000,注意-左右有空格。</p>
<p>除了bootz 命令外，有些系统里面还可能存在一个叫做bootm命令，这是是对没有使用设备树内核的镜像启动命令，早期版本的内核没有引入设备树，因此对于早期的内核一般使用的是bootm，其命令格式为bootm内核地址，比如bootm x0x30008000，意思是从0x30008000开始启动内核，启动内核的过程其实是将pc指针指向该地址，这样处理器就会从该地址处运行代码。</p>
<p> 这里我们就完成了bootcmd的说明，接下来我们看另外一个参数。</p>
<p><strong>bootargs</strong></p>
<p>bootargs也是u-boot环境变量中一个非常重要的变量，上面已经讲解了内核的启动可以通过bootcmd来完成，那接下来内核启动完毕后必须挂在根文件系统(rootfs)。但是内核并不知道根文件系统的具体位置，我们必须要告诉根文件的位置后内核才能将其挂载，这时就需要有bootargs变量。该变量的作用是告诉内核根文件系统的位置和属性以及必要的配置，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console&#x3D;ttyS0,115200 panic&#x3D;5 rootwait root&#x3D;&#x2F;dev&#x2F;mmcblk0p2 earlyprintk rw</span><br></pre></td></tr></table></figure>

<p>同上面分析的方法一样，我们依然将这部分命令拆成几部分来说明。这里需要说明的是，这部分配置信息是由u-boot 直接按照参数字符串方式提供给Linux内核，然后由Linux内核进行执行的，这也说明里为什么格式与bootcmd配置方式不一致。</p>
<p><strong>console&#x3D;ttyS0,115200</strong> 表示终端为ttyS0即串口0,波特率为115200；</p>
<p><strong>panic&#x3D;5</strong> 字面意思是恐慌，即linux内核恐慌，其实就是linux不知道怎么执行了，此时内核就需要做一些相关的处理，这里的5表示超时时间，当Linux卡住5秒后仍未成功就会执行Linux恐慌异常的一些操作。</p>
<p><strong>rootwait</strong> 该参数是告诉内核挂在文件系统之前需要先加载相关驱动，这样做的目的是防止因mmc驱动还未加载就开始挂载驱动而导致文件系统挂载失败，所以一般bootargs中都要加上这个参数。</p>
<p><strong>root&#x3D;&#x2F;dev&#x2F;mmcblk0p2</strong> 表示根文件系统的位置在mmc的0:2分区处，**&#x2F;dev<strong>是设备文件夹，内核在加载mmc中的时候就会在根文件系统中生成</strong>mmcblk0p2**设备文件，这个设备文件其实就是mmc的0:2分区(这里对应TF卡的第二个分区：rootfs)，这样内核对文件系统的读写操作方式本质上就是读写&#x2F;dev&#x2F;mmcblk0p2该设备文件。</p>
<p><strong>earlyprintk</strong> 参数是指在内核加载的过程中打印输出信息，这样内核在加载的时候终端就会输出相应的启动信息。rw表示文件系统的操作属性，此处rw表示可读可写。</p>
<h2 id="5-u-boot参数配置"><a href="#5-u-boot参数配置" class="headerlink" title="5.u-boot参数配置 #"></a>5.u-boot参数配置 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/twzy/p/14865952.html#5.u-boot%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE">#</a></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make menuconfig</span><br></pre></td></tr></table></figure>

<p> 选中  <strong>Enable boot arguments</strong> 按空格选中，下面会显示：() <strong>Boot arguments</strong></p>
<p>然后选中<strong>Boot arguments</strong> ,按回车，进入配置窗口，接下来上面解释过的<strong>bootargs</strong> 参数信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console&#x3D;ttyS0,115200 panic&#x3D;5 rootwait root&#x3D;&#x2F;dev&#x2F;mmcblk0p2 earlyprintk rw</span><br></pre></td></tr></table></figure>

<p> <a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202109/483434-20210928152101050-1297588046.png"><img src="/posts/undefined/483434-20210928152101050-1297588046.png" class="" title="img"></a></p>
<p> 配置bootargs信息</p>
<p>然后按<strong>Tab</strong>键选中**<OK>**，保存并进入主菜单。</p>
<p>同理配置：<strong>Enable a default value for bootcmd</strong> 按空格选中，下面会显示：**() bootcmd value** 配置项，</p>
<p>选中<strong>bootcmd value</strong> 进入配置界面，输入bootcmd命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load mmc 0:1 0x80008000 zImage;load mmc 0:1 0x80c08000 suniv-f1c100s-licheepi-nano.dtb;bootz 0x80008000 - 0x80c08000;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202109/483434-20210928152626755-371939279.png"><img src="/posts/undefined/483434-20210928152626755-371939279.png" class="" title="img"></a></p>
<p> 配置bootcmd参数</p>
<p> 按<strong>Tab</strong>键选中**<OK>**，保存并进入主菜单。</p>
<h2 id="6-u-boot编译与烧录"><a href="#6-u-boot编译与烧录" class="headerlink" title="6.u-boot编译与烧录#"></a>6.u-boot编译与烧录<a target="_blank" rel="noopener" href="https://www.cnblogs.com/twzy/p/14865952.html#6.u-boot%E7%BC%96%E8%AF%91%E4%B8%8E%E7%83%A7%E5%BD%95">#</a></h2><p>先保存图形配置界面后推出界面，在终端执行make -j4即可对整个u-boot进行编译。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make -j4</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202109/483434-20210928152943605-978425396.png"><img src="/posts/undefined/483434-20210928152943605-978425396.png" class="" title="img"></a></p>
<p>编译u-boot</p>
<p><strong>make -j4</strong>后面的-j4表示4个核心进行编译，若电脑的处理器是2核心，请使用make -j2进行编译。</p>
<p>编译完成后会在当前目录生成<strong>u-boot-sunxi-with-spl.bin</strong>烧录文件。</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202109/483434-20210928153312700-1418379375.png"><img src="/posts/undefined/483434-20210928153312700-1418379375.png" class="" title="img"></a></p>
<p>根目录下找到 <strong>u-boot-sunxi-with-spl.bin</strong> 文件</p>
<p>该文件就是我们最终要烧录的二进制文件。</p>
<p>在当前目录下会有一个隐藏的文件.config，该文件是u-boot编译后根据各个选项产生的配置文件，这个配置文件记录了所有配置选项的宏开关，编译的时候是根据最终的.config文件来进行编译的，当然编译前是需要有脚本解析.config文件然后进行相应的编译。</p>
<p>烧录到TF卡</p>
<p>只要将u-boot-sunxi-with-spl.bin烧录到tf卡的8k偏移处地址就可以了，烧录步骤如下：使用dd命令进行块搬移：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dd if&#x3D;u-boot-sunxi-with-spl.bin of&#x3D;&#x2F;dev&#x2F;sdb bs&#x3D;1024 seek&#x3D;8</span><br></pre></td></tr></table></figure>

<p>该命令中：</p>
<p>​    <strong>if</strong>  文件名：输入文件名，缺省为标准输入。即指定源文件。&lt; if&#x3D;input file &gt;</p>
<p>​    <strong>of</strong>  文件名：输出文件名，缺省为标准输出。即指定目的文件。&lt; of&#x3D;output file &gt;</p>
<p>​    <strong>bs</strong> bytes：同时设置读入&#x2F;输出的块大小为bytes个字节。</p>
<p>​    <strong>seek</strong> blocks：从输出文件开头跳过blocks个块后再开始复制。</p>
<p>这里的输出文件(<strong>of</strong>)为主机电脑的&#x2F;dev&#x2F;sdb文件，也就是TF卡，这里也体现了Linux一切皆文件的思想。</p>
<p><strong>&#x2F;dev&#x2F;sdb</strong> 这个可以用gparted 软件查看，该软件可以直接用命令安装即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install gparted</span><br></pre></td></tr></table></figure>

<p>此时在Ubuntu下面可以看到如下软件：</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202109/483434-20210930081032210-139894885.png"><img src="/posts/undefined/483434-20210930081032210-139894885.png" class="" title="img"></a></p>
<p>安装好GParted软件</p>
<p> 打开软件</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202109/483434-20210930081827917-1823480007.png"><img src="/posts/undefined/483434-20210930081827917-1823480007.png" class="" title="img"></a></p>
<p>GParted</p>
<p>在右上角可以看到两个硬盘，&#x2F;dev&#x2F;sda 为本地硬盘，&#x2F;dev&#x2F;sdb 是我们将要写数据的TF(当然这只是墨云自己的配置使然，具体情况请根据实际情况而定)，因此这里的of&#x3D;&#x2F;dev&#x2F;sdb 烧录到8k偏移地址处是指绝对地址，这个绝对地址指的是TF卡的物理地址。这8K的值是由F1C200S 中固化的启动代码决定的，所以照抄即可。</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202109/483434-20210930082436650-910788822.png"><img src="/posts/undefined/483434-20210930082436650-910788822.png" class="" title="img"></a></p>
<p>烧写u-boot</p>
<p>然后我们正常退出TF卡，然后插入我们自制的开发板，通过USB线连接电脑，</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202109/483434-20210930085606475-1688206025.png"><img src="/posts/undefined/483434-20210930085606475-1688206025.png" class="" title="img"></a></p>
<p>连接开发板</p>
<p>打开电脑中的命令行工具，我这里使用Xshell，</p>
<p>打开Xshell，新建连接：</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202109/483434-20210930084928442-133473812.png"><img src="/posts/undefined/483434-20210930084928442-133473812.png" class="" title="img"></a></p>
<p>配置名称 ，协议选择Serial,</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202109/483434-20210930085149724-1946801432.png"><img src="/posts/undefined/483434-20210930085149724-1946801432.png" class="" title="img"></a></p>
<p> 配置串口</p>
<p>通过下拉选中com端口，波特率为115200，其他默认即可，点击确定，然后双击主界面左侧会话管理中的刚建立的会话，此时进入连接状态。</p>
<p>因为在你插入USB通电的时候开发板就已经启动了，所以当你打开串口连接的时候可能未必会看到信息，所以按一下重启键，就可以看到如下的输出信息了，这就是我们的u-boot，执行到u-bbot计数完成后会产生错误，那是因为我们还没有进行系统内核的移植，所以默认就会进入u-boot命令模式。</p>
<p> <a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202109/483434-20210930084405807-1935485286.png"><img src="/posts/undefined/483434-20210930084405807-1935485286.png" class="" title="img"></a></p>
<p> 启动信息</p>
<p> 输入pri命令打印环境变量的所有值，可以找到已经配置的bootcmd 和bootargs</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202109/483434-20210930090109593-1345294928.png"><img src="/posts/undefined/483434-20210930090109593-1345294928.png" class="" title="img"></a></p>
<p> pri命令结果</p>
<p>至此完成了u-boot移植的全部内容，对于u-boot的移植方法，在后续移植Linux内核和文件系统时都会用到，都是大同小异的，所以有了本篇的说明，之后操作将会非常简单。</p>
<p>而关于u-boot的内容事实上非常的复杂繁琐，有兴趣的可以自行去了解到，毕竟作为一个小白的我初衷只是先让小板先跑起来。</p>
<h2 id=""><a href="#" class="headerlink" title="#"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/twzy/p/14865952.html#">#</a></h2><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料#"></a>参考资料<a target="_blank" rel="noopener" href="https://www.cnblogs.com/twzy/p/14865952.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">#</a></h2><blockquote>
<p>Lite200 (lishanwen) – <a target="_blank" rel="noopener" href="https://lishanwen.cn/index.php/2021/07/03/lite200/">https://lishanwen.cn/index.php/2021/07/03/lite200/</a></p>
<p>全志F1C200S F1C100S 介绍 ( 迪卡魏曼依奇君 ) <a target="_blank" rel="noopener" href="https://blog.csdn.net/tunqimai9331/article/details/95938903">https://blog.csdn.net/tunqimai9331/article/details/95938903</a></p>
<p>荔枝派Nano 全流程指南 (矽速科技) <a target="_blank" rel="noopener" href="https://wiki.sipeed.com/soft/Lichee/zh/Nano-Doc-Backup/index.html">https://wiki.sipeed.com/soft/Lichee/zh/Nano-Doc-Backup/index.html</a></p>
</blockquote>
<h1 id="三-Linux内核与文件系统移植"><a href="#三-Linux内核与文件系统移植" class="headerlink" title="三. Linux内核与文件系统移植"></a>三. Linux内核与文件系统移植</h1><h2 id="1-Linux内核"><a href="#1-Linux内核" class="headerlink" title="1.Linux内核#"></a>1.Linux内核<a target="_blank" rel="noopener" href="https://www.cnblogs.com/twzy/p/15355842.html#1.linux%E5%86%85%E6%A0%B8">#</a></h2><p>事实上对于F1C100S&#x2F;F1C200S，Linux官方源码已经对licheepi nano进行支持。所以我们完全可以通过licheepi nano的配置文件进行移植。</p>
<h3 id="1-1-下载内核源码"><a href="#1-1-下载内核源码" class="headerlink" title="1.1. 下载内核源码#"></a>1.1. 下载内核源码<a target="_blank" rel="noopener" href="https://www.cnblogs.com/twzy/p/15355842.html#1.1.-%E4%B8%8B%E8%BD%BD%E5%86%85%E6%A0%B8%E6%BA%90%E7%A0%81">#</a></h3><p>进入Linux系统官网：</p>
<p><a target="_blank" rel="noopener" href="https://www.kernel.org/">https://www.kernel.org/</a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202109/483434-20210930145110377-1315647665.png"><img src="/posts/undefined/483434-20210930145110377-1315647665.png" class="" title="img"></a></p>
<p>这里面列出的都是一些主要版本，如主线版本，上时间支持版本，个人推荐使用最新的长时间支持版本（5.10.69）。但是因为我这个项目是在参考一位大神的文档的基础上构建的，所以使用的是5.7.1版本，接下来就给一个选择其他版本的方式。</p>
<p>选择任意一项点击 [browse]</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202109/483434-20210930145220044-1573759475.png"><img src="/posts/undefined/483434-20210930145220044-1573759475.png" class="" title="img"></a></p>
<p>在新打开页面选择 【summary】点击【tag】中的【…】切换下载</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202109/483434-20210930145316299-265231365.png"><img src="/posts/undefined/483434-20210930145316299-265231365.png" class="" title="img"></a></p>
<p> 如果想要直接下载5.7.1版本，请直接使用下面的连接</p>
<p><a target="_blank" rel="noopener" href="https://mirrors.edge.kernel.org/pub/linux/kernel/v5.x/linux-5.7.1.tar.gz">https://mirrors.edge.kernel.org/pub/linux/kernel/v5.x/linux-5.7.1.tar.gz</a></p>
<p>下载后完成后，将代码复制到Ubuntu虚拟机并解压源码。</p>
<h3 id="1-2-配置编译"><a href="#1-2-配置编译" class="headerlink" title="1.2.配置编译#"></a>1.2.配置编译<a target="_blank" rel="noopener" href="https://www.cnblogs.com/twzy/p/15355842.html#1.2.%E9%85%8D%E7%BD%AE%E7%BC%96%E8%AF%91">#</a></h3><p>与上一篇中编译u-boot一样，我们也需要配置对Linux编译进行配置：</p>
<ul>
<li>指定架构类型</li>
<li>指定交叉编译工具</li>
<li>项目配置</li>
</ul>
<p>指定架构，就这个很好理解，就是指定CPU类型，就是配置为Arm就行，交叉编译工具即为上一篇已经安装好的编译工具。</p>
<p>用VS打开Linux内核代码，找到<strong>Makefile</strong>文件：</p>
<p>修改如下配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ARCH              ?&#x3D; arm</span><br><span class="line">CROSS_COMPILE     ?&#x3D;arm-linux-gnueabi-</span><br></pre></td></tr></table></figure>

<p>如果没找到ARCH 或 CROSS_COMPILE字段，自己手动添加也行，如下图所示：</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202109/483434-20210930151530833-1001068341.png"><img src="/posts/undefined/483434-20210930151530833-1001068341.png" class="" title="img"></a></p>
<blockquote>
<p> 事实上这两个字段可以不用指定，在进行make的时候加上对应的参数就行，这里为了避免麻烦，所以直接放到了makefile文件中</p>
</blockquote>
<p>接下来就是指定项目配置了，这个操作就是让Linux内核认F1C100S&#x2F;F1C200S这颗soc。</p>
<p>进入内核源码中的<strong>arch&#x2F;arm&#x2F;configs</strong>目录中，可以看到有很多开发板的配置文件，其中<strong>sunxi_defconfig</strong>是全志的配置文件，但是该配置文件非常不全，需要额外配置大量的选项，一般选项多大上千个，这里先使用licheepi_nano的配置文件。</p>
<p><a target="_blank" rel="noopener" href="https://files.cnblogs.com/files/twzy/linux-licheepi_nano_defconfig.zip"> https://files.cnblogs.com/files/twzy/linux-licheepi_nano_defconfig.zip</a></p>
<p>下载该文件，解压出<strong>linux-licheepi_nano_defconfig</strong>，然后将其放到arch&#x2F;arm&#x2F;configs&#x2F;目录下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202109/483434-20210930154001937-799886630.png"><img src="/posts/undefined/483434-20210930154001937-799886630.png" class="" title="img"></a></p>
<p> 然后通过终端进入Linux-5.7.1根目录，输入命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make menuconfig</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211005103913552-1730316057.png"><img src="/posts/undefined/483434-20211005103913552-1730316057.png" class="" title="img"></a></p>
<p> 进入图形配置界面，如图所示：</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211005104057991-2077580949.png"><img src="/posts/undefined/483434-20211005104057991-2077580949.png" class="" title="img"></a></p>
<p>该界面和u-boot配置一样，所以操作方式也是一样的，上下键移动选项，使用空格键进行选中或取消选择，同样通过空格键或回车键，进入子选项配置，通过Tab键选择保存和退出即可返回上级菜单或命令行界面，也可以直接双击Esc键返回上级目录。</p>
<h3 id="1-3-配置TF卡设备树信息"><a href="#1-3-配置TF卡设备树信息" class="headerlink" title="1.3 配置TF卡设备树信息#"></a>1.3 配置TF卡设备树信息<a target="_blank" rel="noopener" href="https://www.cnblogs.com/twzy/p/15355842.html#1.3-%E9%85%8D%E7%BD%AEtf%E5%8D%A1%E8%AE%BE%E5%A4%87%E6%A0%91%E4%BF%A1%E6%81%AF">#</a></h3><p>我们在完成内核配置后还需要配置TF卡的设备树配置，否则即便是能正常运行内核，在加载文件系统的时候还是会有问题，在这里配置很简单：</p>
<p>在<strong>linux-5.7.1&#x2F;arch&#x2F;arm&#x2F;boot&#x2F;dts</strong> 目录下，分别修改<strong>suniv-f1c100s.dtsi</strong>、<strong>suniv-f1c100s-licheepi-nano.dts</strong> 两个文件（记住这两个文件、以后我们修改的地方多了^_^）</p>
<p>修改<strong>suniv-f1c100s.dtsi</strong>文件</p>
<p>首先添加头文件(如果有则忽略)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;dt-bindings&#x2F;clock&#x2F;suniv-ccu-f1c100s.h&gt;</span><br><span class="line">#include &lt;dt-bindings&#x2F;reset&#x2F;suniv-ccu-f1c100s.h&gt;</span><br></pre></td></tr></table></figure>

<p>在soc-&gt;pio 下添加如下代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mmc0_pins: mmc0-pins &#123;</span><br><span class="line">                pins &#x3D; &quot;PF0&quot;, &quot;PF1&quot;, &quot;PF2&quot;, &quot;PF3&quot;, &quot;PF4&quot;, &quot;PF5&quot;;</span><br><span class="line">                function &#x3D; &quot;mmc0&quot;;</span><br><span class="line">            &#125;;</span><br></pre></td></tr></table></figure>

<p>soc下添加如下代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mmc0: mmc@1c0f000 &#123;</span><br><span class="line">            compatible &#x3D; &quot;allwinner,suniv-f1c100s-mmc&quot;,</span><br><span class="line">                     &quot;allwinner,sun7i-a20-mmc&quot;;</span><br><span class="line">            reg &#x3D; &lt;0x01c0f000 0x1000&gt;;</span><br><span class="line">            clocks &#x3D; &lt;&amp;ccu CLK_BUS_MMC0&gt;,</span><br><span class="line">                 &lt;&amp;ccu CLK_MMC0&gt;,</span><br><span class="line">                 &lt;&amp;ccu CLK_MMC0_OUTPUT&gt;,</span><br><span class="line">                 &lt;&amp;ccu CLK_MMC0_SAMPLE&gt;;</span><br><span class="line">            clock-names &#x3D; &quot;ahb&quot;,</span><br><span class="line">                          &quot;mmc&quot;,</span><br><span class="line">                          &quot;output&quot;,</span><br><span class="line">                          &quot;sample&quot;;</span><br><span class="line">            resets &#x3D; &lt;&amp;ccu RST_BUS_MMC0&gt;;</span><br><span class="line">            reset-names &#x3D; &quot;ahb&quot;;</span><br><span class="line">            interrupts &#x3D; &lt;23&gt;;</span><br><span class="line">            pinctrl-names &#x3D; &quot;default&quot;;</span><br><span class="line">            pinctrl-0 &#x3D; &lt;&amp;mmc0_pins&gt;;</span><br><span class="line">            status &#x3D; &quot;disabled&quot;;</span><br><span class="line">            #address-cells &#x3D; &lt;1&gt;;</span><br><span class="line">            #size-cells &#x3D; &lt;0&gt;;</span><br><span class="line">        &#125;;</span><br></pre></td></tr></table></figure>

<p>如图，图中的配置可能与读者实际内容不一致，这是因为我改了很多东西，忽略即可，只需要关注红色框中的内容即可。</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211009162310863-1685576565.png"><img src="/posts/undefined/483434-20211009162310863-1685576565.png" class="" title="img"></a></p>
<p> 修改<strong>suniv-f1c100s-licheepi-nano.dts</strong>文件，在根节点添加如下代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">reg_vcc3v3: vcc3v3 &#123;</span><br><span class="line">        compatible &#x3D; &quot;regulator-fixed&quot;;</span><br><span class="line">        regulator-name &#x3D; &quot;vcc3v3&quot;;</span><br><span class="line">        regulator-min-microvolt &#x3D; &lt;3300000&gt;;</span><br><span class="line">        regulator-max-microvolt &#x3D; &lt;3300000&gt;;</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>

<p>外部添加mmc0使能代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&amp;mmc0 &#123;</span><br><span class="line">        vmmc-supply &#x3D; &lt;&amp;reg_vcc3v3&gt;;</span><br><span class="line">        bus-width &#x3D; &lt;4&gt;;</span><br><span class="line">        broken-cd;</span><br><span class="line">        status &#x3D; &quot;okay&quot;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>位置如下图</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202201/483434-20220114080223936-810553130.png"><img src="/posts/undefined/483434-20220114080223936-810553130.png" class="" title="img"></a></p>
<p>接下来执行make命令开始编译内核和设备树相关的文件了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure>

<p>首次进行编译，通常会需要很长时间，编译完成后，就会在在<strong>arch&#x2F;arm&#x2F;boot</strong>目录下生成内核文件：<strong>zImage</strong>，在<strong>arch&#x2F;arm&#x2F;boot&#x2F;dts</strong>目录下设备树文件：<strong>suniv-f1c100s-licheepi-nano.dtb</strong> 。</p>
<p>在编译过程中，因为所配置Ubuntu系统的差异，可能会因缺少某些组件导致编译报错，不要慌，将对应的错误关键信息复制到搜索引擎后安装即可，一下是作者碰到的两个编译报错，如果有必要可以提前安装：</p>
<p> <strong>linux-内核编译配置 lexer.lex.c错误</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">wu@ubuntu:~&#x2F;linux-5.4.8$ make exynos_defconfig</span><br><span class="line">HOSTCC scripts&#x2F;basic&#x2F;fixdep</span><br><span class="line">HOSTCC scripts&#x2F;kconfig&#x2F;conf.o</span><br><span class="line">HOSTCC scripts&#x2F;kconfig&#x2F;confdata.o</span><br><span class="line">HOSTCC scripts&#x2F;kconfig&#x2F;expr.o</span><br><span class="line">LEX scripts&#x2F;kconfig&#x2F;lexer.lex.c</span><br><span class="line">&#x2F;bin&#x2F;sh: 1: flex: not found</span><br><span class="line">scripts&#x2F;Makefile.host:9: recipe for target ‘scripts&#x2F;kconfig&#x2F;lexer.lex.c’ failed</span><br><span class="line">make[1]: * [scripts&#x2F;kconfig&#x2F;lexer.lex.c] Error 127</span><br><span class="line">Makefile:567: recipe for target ‘exynos_defconfig’ failed</span><br><span class="line">make: * [exynos_defconfig] Error 2 </span><br></pre></td></tr></table></figure>

<p>解决方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install bison</span><br><span class="line">sudo apt-get install flex</span><br></pre></td></tr></table></figure>

<p><strong>编译Linux内核时遇到：“error : openssl&#x2F;bio.h :No such file or folder”</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">scripts&#x2F;extract-cert.c:21:25: fatal error: openssl&#x2F;bio.h: No such file or directory</span><br><span class="line">compilation terminated.</span><br><span class="line">scripts&#x2F;Makefile.host:90: recipe for target &#39;scripts&#x2F;extract-cert&#39; failed</span><br><span class="line">make[1]: * [scripts&#x2F;extract-cert] Error 1</span><br><span class="line">Makefile:556: recipe for target &#39;scripts&#39; failed</span><br><span class="line">make: * [scripts] Error 2</span><br></pre></td></tr></table></figure>

<p>安装openssl：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install libssl-dev</span><br></pre></td></tr></table></figure>

<h3 id="1-4-TF分区配置"><a href="#1-4-TF分区配置" class="headerlink" title="1.4 TF分区配置#"></a>1.4 TF分区配置<a target="_blank" rel="noopener" href="https://www.cnblogs.com/twzy/p/15355842.html#1.4-tf%E5%88%86%E5%8C%BA%E9%85%8D%E7%BD%AE">#</a></h3><p>在上一篇中提到过u-boot 中的bootcmd 配置了Linux内核文件和设备树文件存放位置，即TF卡的0:1分区中，而且我们已经得到了对应的文件，那我们应该怎么操作呢。</p>
<p>还记得我们在上一篇中安装的Gparted软件吗，如果不记得，可以通过以下命令安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install gparted</span><br></pre></td></tr></table></figure>

<p>把需要写入系统的TF卡插到电脑的USB上，打开该软件，可以看到此时有两个存储设备，一个是sda另一个是sdb，其中sdb就是我们的TF卡。如图：</p>
<p> <a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211009080733737-2007833399.png"><img src="/posts/undefined/483434-20211009080733737-2007833399.png" class="" title="img"></a></p>
<p>选中sdb，我们可以看到分区表中显示为未分配，对于常规Linux嵌入式系统我们需要分两个区，一个是存放zImage和dtb文件，即在bootcmd中配置的0:1分区，另一个区存放根文件系统。对于第一个分区，格式为fat16格式，因为u-boot只能识别这个格式，对于第二个区，一般为ext4格式，为Linux内核识别的格式。下面开始分区吧。</p>
<p>选中未分配空间并右击鼠标，点击[新建]，然后填写相关属性，然后点击[添加],所示。</p>
<p> <a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211009081003602-856502421.png"><img src="/posts/undefined/483434-20211009081003602-856502421.png" class="" title="img"></a></p>
<p> 需要注意【之前的空余空间】选择1M，这是给u-boot预留的(u-boot在分区表中是无法看到的)，【新大小】选择32M ，【文件系统】选择fat16，【卷标】输入boot。</p>
<p>我们这里可以用相同的方式新建第二分区——ext4分区，如下图</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211009081827144-1948779214.png"><img src="/posts/undefined/483434-20211009081827144-1948779214.png" class="" title="img"></a></p>
<p> 这里我们设置为100M，文件系统为ext4，卷标为rootfs，然后添加添加。</p>
<p>配置好分区表后，点击工具来中的【对钩】使配置的分区表生效。</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211009082014437-279426574.png"><img src="/posts/undefined/483434-20211009082014437-279426574.png" class="" title="img"></a></p>
<p>配置分区完毕后，我们就可以在文件管理器中看到挂载的两个分区，如图</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211009082321646-1578987260.png"><img src="/posts/undefined/483434-20211009082321646-1578987260.png" class="" title="img"></a></p>
<h3 id="1-5-内核复制与执行"><a href="#1-5-内核复制与执行" class="headerlink" title="1.5 内核复制与执行#"></a>1.5 内核复制与执行<a target="_blank" rel="noopener" href="https://www.cnblogs.com/twzy/p/15355842.html#1.5-%E5%86%85%E6%A0%B8%E5%A4%8D%E5%88%B6%E4%B8%8E%E6%89%A7%E8%A1%8C">#</a></h3><p>那么，我们将刚才生成好的zImage和dtb文件复制到TF卡的BOOT分区中</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211009082706512-1631849134.png"><img src="/posts/undefined/483434-20211009082706512-1631849134.png" class="" title="img"></a></p>
<p>退出TF卡，插入开发板，上电，按重启，我们就可以看到u-boot启动完成后，自动进入了内核启动环节，但是启动后一会就报错了，因为挂载文件系统产生错误。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">U-Boot SPL 2018.01-05679-g013ca457fd-dirty (Sep 28 2021 - 15:29:32)</span><br><span class="line">DRAM: 32 MiB</span><br><span class="line">Trying to boot from MMC1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">U-Boot 2018.01-05679-g013ca457fd-dirty (Sep 28 2021 - 15:29:32 +0800) Allwinner Technology</span><br><span class="line"></span><br><span class="line">CPU:   Allwinner F Series (SUNIV)</span><br><span class="line">Model: Snail Card</span><br><span class="line">DRAM:  32 MiB</span><br><span class="line">MMC:   SUNXI SD&#x2F;MMC: 0</span><br><span class="line">*** Warning - bad CRC, using default environment</span><br><span class="line"></span><br><span class="line">In:    serial@1c25000</span><br><span class="line">Out:   serial@1c25000</span><br><span class="line">Err:   serial@1c25000</span><br><span class="line">Net:   No ethernet found.</span><br><span class="line">starting USB...</span><br><span class="line">No controllers found</span><br><span class="line">Hit any key to stop autoboot:  0 </span><br><span class="line">reading zImage</span><br><span class="line">4515448 bytes read in 231 ms (18.6 MiB&#x2F;s)</span><br><span class="line">reading suniv-f1c100s-licheepi-nano.dtb</span><br><span class="line">6105 bytes read in 26 ms (228.5 KiB&#x2F;s)</span><br><span class="line">## Flattened Device Tree blob at 80c00000</span><br><span class="line">   Booting using the fdt blob at 0x80c00000</span><br><span class="line">   Loading Device Tree to 816fb000, end 816ff7d8 ... OK</span><br><span class="line"></span><br><span class="line">Starting kernel ...</span><br><span class="line"></span><br><span class="line">[    0.000000] Booting Linux on physical CPU 0x0</span><br><span class="line">[    0.000000] Linux version 5.7.1 (twzy@ubuntu) (gcc version 7.2.1 20171011 (Linaro GCC 7.2-2017.11), GNU ld (Linaro_Binutils-2017.11) 2.28.2.20170706) #55 Tue Sep 28 21:04:24 CST 2021</span><br><span class="line">[    0.000000] CPU: ARM926EJ-S [41069265] revision 5 (ARMv5TEJ), cr&#x3D;0005317f</span><br><span class="line">[    0.000000] CPU: VIVT data cache, VIVT instruction cache</span><br><span class="line">[    0.000000] OF: fdt: Machine model: LinuxCard by Kevin</span><br><span class="line">[    0.000000] Memory policy: Data cache writeback</span><br><span class="line">[    0.000000] Built 1 zonelists, mobility grouping on.  Total pages: 8128</span><br><span class="line">[    0.000000] Kernel command line: console&#x3D;tty0 console&#x3D;ttyS0,115200 panic&#x3D;5 rootwait root&#x3D;&#x2F;dev&#x2F;mmcblk0p2  rw</span><br><span class="line">[    0.000000] Dentry cache hash table entries: 4096 (order: 2, 16384 bytes, linear)</span><br><span class="line">[    0.000000] Inode-cache hash table entries: 2048 (order: 1, 8192 bytes, linear)</span><br><span class="line">[    0.000000] mem auto-init: stack:off, heap alloc:off, heap free:off</span><br><span class="line">[    0.000000] Memory: 21496K&#x2F;32768K available (7168K kernel code, 403K rwdata, 1664K rodata, 1024K init, 246K bss, 11272K reserved, 0K cma-reserved, 0K highmem)</span><br><span class="line">[    0.000000] SLUB: HWalign&#x3D;32, Order&#x3D;0-3, MinObjects&#x3D;0, CPUs&#x3D;1, Nodes&#x3D;1</span><br><span class="line"></span><br><span class="line"> …………………</span><br><span class="line"></span><br><span class="line">[    6.598874] Run &#x2F;etc&#x2F;init as init process</span><br><span class="line">[    6.603993] Run &#x2F;bin&#x2F;init as init process</span><br><span class="line">[    6.609078] Run &#x2F;bin&#x2F;sh as init process</span><br><span class="line">[    6.613763] Kernel panic - not syncing: No working init found.  Try passing init&#x3D; option to kernel. See Linux Documentation&#x2F;admin-guide&#x2F;init.rst for guidance.</span><br><span class="line">[    6.629985] CPU: 0 PID: 1 Comm: swapper Not tainted 5.7.1 #55</span><br><span class="line">[    6.636727] Hardware name: Allwinner suniv Family</span><br><span class="line">[    6.642216] [&lt;c010d604&gt;] (unwind_backtrace) from [&lt;c010ab60&gt;] (show_stack+0x10&#x2F;0x14)</span><br><span class="line">[    6.651031] [&lt;c010ab60&gt;] (show_stack) from [&lt;c01165a4&gt;] (panic+0xe8&#x2F;0x2e4)</span><br><span class="line">[    6.658951] [&lt;c01165a4&gt;] (panic) from [&lt;c071d080&gt;] (kernel_init+0xd8&#x2F;0x110)</span><br><span class="line">[    6.666960] [&lt;c071d080&gt;] (kernel_init) from [&lt;c0100140&gt;] (ret_from_fork+0x14&#x2F;0x34)</span><br><span class="line">[    6.675547] Exception stack(0xc1835fb0 to 0xc1835ff8)</span><br><span class="line">[    6.681293] 5fa0:                                     00000000 00000000 00000000 00000000</span><br><span class="line">[    6.690714] 5fc0: 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000</span><br><span class="line">[    6.700102] 5fe0: 00000000 00000000 00000000 00000000 00000013 00000000</span><br><span class="line">[    6.707633] Rebooting in 5 seconds..</span><br><span class="line">[   12.687513] Reboot failed -- System halted</span><br></pre></td></tr></table></figure>

<p>内核移植就基本结束了，要想让小板真正的运行起来，还需要Linux的文件系统，那开始吧。</p>
<h2 id="2-文件系统移植"><a href="#2-文件系统移植" class="headerlink" title="2.文件系统移植#"></a>2.文件系统移植<a target="_blank" rel="noopener" href="https://www.cnblogs.com/twzy/p/15355842.html#2.%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%A7%BB%E6%A4%8D">#</a></h2><p> 根文件系统(rootfs)是内核启动后挂载的第一个文件系统，如果没有根文件系统，内核将无法开启shell以及其他进程。</p>
<blockquote>
<p>实际上内核启动后会先挂载一个虚拟的文件系统，这个虚拟文件系统是在内存中运行的，其主要运行核心进程，虚拟文件系统挂载之后才挂载硬盘（TF卡或者emmc）上的根文件系统。</p>
</blockquote>
<p>制作文件系统也有很多方式，如通过busyBox、Buildroot等工具制作。</p>
<p>本次使用Buildroot，制作过程相对简单，兼容性好，由于根文件系统制作比较简单。</p>
<p>进入buildroot官网</p>
<p><a target="_blank" rel="noopener" href="https://buildroot.org/downloads">https://buildroot.org/downloads</a></p>
<p>这里选择buildroot2018.2.11版本，将下载好软件包传入Ubuntu系统中，然后解压并进入源码目录中，输入清理命令。主要用于初始化一些设置，命令如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make clean</span><br></pre></td></tr></table></figure>

<p>然后输入以下命令进入配置界面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make menuconfig</span><br></pre></td></tr></table></figure>

<p>此时会终端进入图形配置界面，如图：</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211009144509521-972063330.png"><img src="/posts/undefined/483434-20211009144509521-972063330.png" class="" title="img"></a></p>
<h3 id="2-1-Target-options配置"><a href="#2-1-Target-options配置" class="headerlink" title="2.1 Target options配置#"></a><strong>2.1 Target options配置</strong><a target="_blank" rel="noopener" href="https://www.cnblogs.com/twzy/p/15355842.html#2.1-target-options%E9%85%8D%E7%BD%AE">#</a></h3><p>先选择<strong>Target options</strong>选项，进行对应芯片soc相关的配置，如图：</p>
<p> <a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211009144541062-504084831.png"><img src="/posts/undefined/483434-20211009144541062-504084831.png" class="" title="img"></a></p>
<p>配置如图所示，下面是对其的解释</p>
<ul>
<li>第一个选项为架构选择，这里选择ARM架构小端模式，</li>
<li>第二个为输出的二进制文件格式，这里选择EFL格式，</li>
<li>第三个为架构体系，这里选择arm926t，因为F1C200S&#x2F;F1C100S的架构就是这个架构，</li>
<li>第四个为矢量浮点处理器，这里不勾选，因为对于F1C200S&#x2F;F1C100S而言，其内部没有浮点运算单元，只能进行软浮点运算，也就是模拟浮点预运算。</li>
<li>第五个为应用程序二进制接口，这里选择EABI，原因是该格式支持软件浮点和硬件实现浮点功能混用。</li>
<li>第六个为浮点运算规则，这里使用软件浮点</li>
<li>第七个选择指令集，这里选择ARM指令集，因为thumb主要针对Cortex M系列而言的，对于运行操作系统的A系列以及ARM9和ARM11而言，使用的都是32位的ARM指令集。</li>
</ul>
<p>按【Tab键】选择**<save>**进行保存，按【Esc键】回到上一级配置界面。</p>
<h3 id="2-2-Build-options配置"><a href="#2-2-Build-options配置" class="headerlink" title="2.2 Build options配置#"></a><strong>2.2 Build options配置</strong><a target="_blank" rel="noopener" href="https://www.cnblogs.com/twzy/p/15355842.html#2.2-build-options%E9%85%8D%E7%BD%AE">#</a></h3><p>进入第二个<strong>Build options</strong>选项，配置如图</p>
<p> <a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211009150105319-120500590.png"><img src="/posts/undefined/483434-20211009150105319-120500590.png" class="" title="img"></a></p>
<p>按T【ab键】选择**<save>**进行保存，按【Esc键】回到上一级配置界面。</p>
<h3 id="2-3-Toolchain配置"><a href="#2-3-Toolchain配置" class="headerlink" title="2.3 Toolchain配置#"></a><strong>2.3 Toolchain配置</strong><a target="_blank" rel="noopener" href="https://www.cnblogs.com/twzy/p/15355842.html#2.3-toolchain%E9%85%8D%E7%BD%AE">#</a></h3><p>进入第三个<strong>Toolchain</strong>选项，配置如图：</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211009150540766-1755147867.png"><img src="/posts/undefined/483434-20211009150540766-1755147867.png" class="" title="img"></a></p>
<p>这里我们选择一些C\C++相关的库，这样我们就可以在开发板上直接编译程序了，保存返回。</p>
<h3 id="2-4-System-configuration配置-https-www-cnblogs-com-twzy-p-15355842-html-2-4-system-configuration配置"><a href="#2-4-System-configuration配置-https-www-cnblogs-com-twzy-p-15355842-html-2-4-system-configuration配置" class="headerlink" title="2.4 System configuration配置[#](https://www.cnblogs.com/twzy/p/15355842.html#2.4 system-configuration配置)"></a><strong>2.4 System configuration配置</strong>[#](<a target="_blank" rel="noopener" href="https://www.cnblogs.com/twzy/p/15355842.html#2.4">https://www.cnblogs.com/twzy/p/15355842.html#2.4</a> system-configuration配置)</h3><p>对于<strong>System configuration</strong>选项，这里主要是配置一些系统登录时候显示的内容，配置如图</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211009151624384-1186247221.png"><img src="/posts/undefined/483434-20211009151624384-1186247221.png" class="" title="img"></a></p>
<p>这里主要配置了登录时候显示的内容和root账号登录密码，接下来保存配置并且退回到命令行界面。</p>
<p>然后执行构建文件系统命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure>

<p>因为是首次编译，而且buildroot在制作文件系统的时候需要联网获取组件，所以会编译很久，那么“去和妲己玩耍吧”</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211009153556289-1299034541.png"><img src="/posts/undefined/483434-20211009153556289-1299034541.png" class="" title="img"></a></p>
<p>当你终于被别人坑的自闭的时候，文件系统大概也许可能已经编译完毕了。</p>
<h3 id="2-5-文件系统移植与执行"><a href="#2-5-文件系统移植与执行" class="headerlink" title="2.5 文件系统移植与执行#"></a>2.5 文件系统移植与执行<a target="_blank" rel="noopener" href="https://www.cnblogs.com/twzy/p/15355842.html#2.5-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%A7%BB%E6%A4%8D%E4%B8%8E%E6%89%A7%E8%A1%8C">#</a></h3><p>此时在源码的<strong>output&#x2F;images</strong>目录下有一个rootfs.tar，这个文件就是最终生成的根文件系统镜像，现在只需要将该镜像解压到TF卡的第二分区即可。插入TF卡到电脑端，进入<strong>out&#x2F;images</strong>目录，然后输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># sudo tar -xvf rootfs.tar -C &#x2F;media&#x2F;&lt;你的用户名&gt;&#x2F;rootfs&#x2F;</span><br><span class="line"># 墨云的账号是twzy</span><br><span class="line">sudo tar -xvf rootfs.tar -C &#x2F;media&#x2F;twzy&#x2F;rootfs&#x2F;</span><br></pre></td></tr></table></figure>

<p>此时可以看到TF卡的rootfs分区中有文件系统了</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211009172303012-746246639.png"><img src="/posts/undefined/483434-20211009172303012-746246639.png" class="" title="img"></a></p>
<p>插入开发板，连接好串口，打开串口助手或者其他串口终端软件，可以看到根文件系统成功挂载，同时进入shell交互，用户名默认为root，密码：123456，进入root账号后</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211009172655126-653041256.png"><img src="/posts/undefined/483434-20211009172655126-653041256.png" class="" title="img"></a></p>
<p>那么恭喜，你已经拥有了自己的Linux发行版。</p>
<p>至此我们完成了全部的系统移植任务，从下一篇开始我们将会升级我们的硬件设备和做一些更加有意义的东西，期待吗？</p>
<h3 id="2-6-升级逼格-https-www-cnblogs-com-twzy-p-15355842-html-2-6-升级逼格"><a href="#2-6-升级逼格-https-www-cnblogs-com-twzy-p-15355842-html-2-6-升级逼格" class="headerlink" title="2.6 升级逼格[#](https://www.cnblogs.com/twzy/p/15355842.html#2.6 升级逼格)"></a>2.6 升级逼格[#](<a target="_blank" rel="noopener" href="https://www.cnblogs.com/twzy/p/15355842.html#2.6">https://www.cnblogs.com/twzy/p/15355842.html#2.6</a> 升级逼格)</h3><p>我们发现登录进自制的Linux系统后，命令行前置无论怎样只显示一个**#**号，逼格略低呀，怎么处理呢？</p>
<p>修改&#x2F;etc&#x2F;profile文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure>

<p>写入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PS1&#x3D;&#39;[\u@\h: \w\a\]$&#39;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211009172755348-361576513.png"><img src="/posts/undefined/483434-20211009172755348-361576513.png" class="" title="img"></a></p>
<p>重启小板，就可以看到与与常规Linux一样的操作体验了，只是root账号的时候还是显示 <strong>$</strong> 符号</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211009173048942-1924983487.png"><img src="/posts/undefined/483434-20211009173048942-1924983487.png" class="" title="img"></a></p>
<p>需要注意的是，在开发板运行过程中，如果想要重启，请先执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">poweroff</span><br></pre></td></tr></table></figure>

<p>命令正常关闭系统后，在按重启按钮，否则有很大概率回造成文件系统损坏。</p>
<h2 id="3-点个灯吧"><a href="#3-点个灯吧" class="headerlink" title="3. 点个灯吧#"></a>3. 点个灯吧<a target="_blank" rel="noopener" href="https://www.cnblogs.com/twzy/p/15355842.html#3.-%E7%82%B9%E4%B8%AA%E7%81%AF%E5%90%A7">#</a></h2><p>还记得我们在第一篇中提到过的我们自制小开发板的唯一的那个外设——LED灯吗？</p>
<p>那我们就利用Linux提供的GPIO系统通过shell命令进行点灯实验吧。</p>
<p>我们首先需要回到文件系统制作菜单</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Device Drivers -&gt; </span><br><span class="line">        GPIO Support -&gt;</span><br><span class="line">                &#x2F;sys&#x2F;class&#x2F;gpio&#x2F;… (sysfs interface)。</span><br></pre></td></tr></table></figure>

<p>按如下方式进行配置，然后编译完rootfs，重新写入小板</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211009173731029-1575334130.png"><img src="/posts/undefined/483434-20211009173731029-1575334130.png" class="" title="img"></a></p>
<p> <a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211009163731073-1479927383.png"><img src="/posts/undefined/483434-20211009163731073-1479927383.png" class="" title="img"></a></p>
<p>通过硬件可知LED灯连接的是<strong>PE6</strong>接口，低电平亮灯</p>
<p>这里我们先要了解一下GPIO编号和值的计算方式</p>
<blockquote>
<p>引脚编号 &#x3D; 控制引脚的寄存器基数 + 控制引脚寄存器位数<br>批注：<br>引脚编号是gpiochipxxx下的base + 第几个GPIO，也就是base加偏移，偏移的是位数。<br>例如gpiochip34 下的第1个GPIO那么编号就是34 + 1 &#x3D; 35</p>
</blockquote>
<p>对于F1C200S&#x2F;F1C100S这里：A&#x3D;0、B&#x3D;1、C&#x3D;2D&#x3D;3、E&#x3D;4 ……、32是固定值、6就是偏移量</p>
<p>举个栗子（如果使想用 PE6，那么引脚编号就可能等于 4 x 32 + 6 &#x3D; 134。</p>
<p>这是一些参考命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 1、导出</span><br><span class="line">echo 134 &gt; &#x2F;sys&#x2F;class&#x2F;gpio&#x2F;export</span><br><span class="line"># 2、设置方向</span><br><span class="line">echo out &gt; &#x2F;sys&#x2F;class&#x2F;gpio&#x2F;gpio134&#x2F;direction</span><br><span class="line"># 3、查看方向</span><br><span class="line">cat &#x2F;sys&#x2F;class&#x2F;gpio&#x2F;gpio134&#x2F;direction</span><br><span class="line"># 4、设置输出（对于LED 设置1 为高电平即LED灯灭，设置0 为低电平，LED灯亮）</span><br><span class="line">echo 1 &gt; &#x2F;sys&#x2F;class&#x2F;gpio&#x2F;gpio134&#x2F;value</span><br><span class="line"># 5、查看输出值</span><br><span class="line">cat &#x2F;sys&#x2F;class&#x2F;gpio&#x2F;gpio134&#x2F;value</span><br><span class="line"># 6、取消导出</span><br><span class="line">echo 134 &gt; &#x2F;sys&#x2F;class&#x2F;gpio&#x2F;unexport</span><br></pre></td></tr></table></figure>

<p>输入如下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">echo 134 &gt; &#x2F;sys&#x2F;class&#x2F;gpio&#x2F;export</span><br><span class="line">echo out &gt; &#x2F;sys&#x2F;class&#x2F;gpio&#x2F;gpio134&#x2F;direction # 灯亮 （默认设置为高电平）</span><br><span class="line">echo 0 &gt; &#x2F;sys&#x2F;class&#x2F;gpio&#x2F;gpio134&#x2F;value        # 灯灭 </span><br><span class="line">echo 1 &gt; &#x2F;sys&#x2F;class&#x2F;gpio&#x2F;gpio134&#x2F;value        # 灯亮</span><br><span class="line"></span><br><span class="line">echo 134 &gt; &#x2F;sys&#x2F;class&#x2F;gpio&#x2F;unexport</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211009173632837-1965450968.png"><img src="/posts/undefined/483434-20211009173632837-1965450968.png" class="" title="img"></a></p>
<p> 我们这里借助Linux内建的GPIO子系统进行了电灯实验，但是真正Linux灵魂点灯是要通过驱动方式来实现的，但是谁让我是小白呢，以后再说吧。</p>
<hr>
<h1 id="相关链接（侵删）"><a href="#相关链接（侵删）" class="headerlink" title="相关链接（侵删）"></a>相关链接（侵删）</h1><ol>
<li><a target="_blank" rel="noopener" href="https://whycan.com/t_7275.html">小白自制Linux开发板(F1C200s)整理系列，持续更新中</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/twzy/p/14714651.html">瞎抄原理图与乱画PCB</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/twzy/p/14865952.html"> 二. u-boot移植</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/twzy/p/15355842.html">三. Linux内核与文件系统移植</a></li>
</ol>
<hr>
<center><font color=red>=================我是分割线=================</font></center>


<p><strong>欢迎到公众号来唠嗑:</strong></p>
<img src="https://pic4.zhimg.com/80/v2-eedc5dc7d30beedf4c2f1812df8e61a7_720w.jpg">

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://zml3589110.github.io">ZhaoYichen</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://zml3589110.github.io/posts/3433483963.html">https://zml3589110.github.io/posts/3433483963.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://zml3589110.github.io" target="_blank">赵逸尘个人博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%85%A8%E5%BF%97/">全志</a><a class="post-meta__tags" href="/tags/F1C200S/">F1C200S</a><a class="post-meta__tags" href="/tags/%E5%BC%80%E5%8F%91%E6%9D%BF/">开发板</a><a class="post-meta__tags" href="/tags/Linux/">Linux</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/gh/overtrue/share.js@master/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/0.html"><img class="prev-cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info"></div></div></a></div><div class="next-post pull-right"><a href="/posts/1451356382.html"><img class="next-cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">ESP01S基础资料</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/3905997731.html" title="全志f1c200s开发板设计"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-05</div><div class="title">全志f1c200s开发板设计</div></div></a></div><div><a href="/posts/2357015472.html" title="学习笔记F1C100S之u-boot编译过程记录"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-05</div><div class="title">学习笔记F1C100S之u-boot编译过程记录</div></div></a></div><div><a href="/posts/0.html" title=""><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-05</div><div class="title"></div></div></a></div><div><a href="/posts/246263880.html" title="F1C100SF1C200S 移植FreeRTOS全过程 GCC 版本"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-10</div><div class="title">F1C100SF1C200S 移植FreeRTOS全过程 GCC 版本</div></div></a></div><div><a href="/posts/931990122.html" title="f1c100sf1c200s 裸机程序"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-10</div><div class="title">f1c100sf1c200s 裸机程序</div></div></a></div><div><a href="/posts/2989473239.html" title="自制F1C200S demo板"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-10</div><div class="title">自制F1C200S demo板</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">ZhaoYichen</div><div class="author-info__description">直到这一刻微笑着说话为止，我至少留下了一公升眼泪</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">369</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">527</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">215</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/zml3589110"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/zml3589110" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:zhaominglong_life@outlook.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80-%E7%9E%8E%E6%8A%84%E5%8E%9F%E7%90%86%E5%9B%BE%E4%B8%8E%E4%B9%B1%E7%94%BBPCB"><span class="toc-number">1.</span> <span class="toc-text">一. 瞎抄原理图与乱画PCB</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%B7%A5%E5%85%B7%E4%B8%8E%E8%8A%AF%E7%89%87%E8%AF%B4%E6%98%8E"><span class="toc-number">1.1.</span> <span class="toc-text">1. 工具与芯片说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%8E%9F%E7%90%86%E5%9B%BE%E8%AF%B4%E6%98%8E"><span class="toc-number">1.2.</span> <span class="toc-text">2.原理图说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-PCB%E7%BB%98%E5%88%B6"><span class="toc-number">1.3.</span> <span class="toc-text">3.PCB绘制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-PCB%E7%84%8A%E6%8E%A5"><span class="toc-number">1.4.</span> <span class="toc-text">4.PCB焊接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%90%8E%E8%AE%B0-https-www-cnblogs-com-twzy-p-14714651-html-5-%E5%90%8E%E8%AE%B0"><span class="toc-number">1.5.</span> <span class="toc-text">5. 后记[#](https:&#x2F;&#x2F;www.cnblogs.com&#x2F;twzy&#x2F;p&#x2F;14714651.html# 5.-后记)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E8%B5%84%E6%96%99%E5%8C%85%EF%BC%9A-https-www-cnblogs-com-twzy-p-14714651-html-%E7%A1%AC%E4%BB%B6%E8%B5%84%E6%96%99%E5%8C%85%EF%BC%9A"><span class="toc-number">1.5.1.</span> <span class="toc-text">硬件资料包：[#](https:&#x2F;&#x2F;www.cnblogs.com&#x2F;twzy&#x2F;p&#x2F;14714651.html# 硬件资料包：)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C-u-boot%E7%A7%BB%E6%A4%8D"><span class="toc-number">2.</span> <span class="toc-text">二. u-boot移植</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91%E6%9D%BF%E7%9A%84%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">2.1.</span> <span class="toc-text">1. 嵌入式开发板的启动过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%8F%82%E8%80%83%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.2.</span> <span class="toc-text">2. 环境配置与参考项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E5%99%A8"><span class="toc-number">2.3.</span> <span class="toc-text">3.交叉编译器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E7%BC%96%E8%AF%91U-boot"><span class="toc-number">2.4.</span> <span class="toc-text">4. 编译U-boot</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-u-boot%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE"><span class="toc-number">2.5.</span> <span class="toc-text">5.u-boot参数配置 </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-u-boot%E7%BC%96%E8%AF%91%E4%B8%8E%E7%83%A7%E5%BD%95"><span class="toc-number">2.6.</span> <span class="toc-text">6.u-boot编译与烧录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">2.7.</span> <span class="toc-text">#</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">2.8.</span> <span class="toc-text">参考资料</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89-Linux%E5%86%85%E6%A0%B8%E4%B8%8E%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%A7%BB%E6%A4%8D"><span class="toc-number">3.</span> <span class="toc-text">三. Linux内核与文件系统移植</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Linux%E5%86%85%E6%A0%B8"><span class="toc-number">3.1.</span> <span class="toc-text">1.Linux内核</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E4%B8%8B%E8%BD%BD%E5%86%85%E6%A0%B8%E6%BA%90%E7%A0%81"><span class="toc-number">3.1.1.</span> <span class="toc-text">1.1. 下载内核源码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E9%85%8D%E7%BD%AE%E7%BC%96%E8%AF%91"><span class="toc-number">3.1.2.</span> <span class="toc-text">1.2.配置编译</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E9%85%8D%E7%BD%AETF%E5%8D%A1%E8%AE%BE%E5%A4%87%E6%A0%91%E4%BF%A1%E6%81%AF"><span class="toc-number">3.1.3.</span> <span class="toc-text">1.3 配置TF卡设备树信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-TF%E5%88%86%E5%8C%BA%E9%85%8D%E7%BD%AE"><span class="toc-number">3.1.4.</span> <span class="toc-text">1.4 TF分区配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-%E5%86%85%E6%A0%B8%E5%A4%8D%E5%88%B6%E4%B8%8E%E6%89%A7%E8%A1%8C"><span class="toc-number">3.1.5.</span> <span class="toc-text">1.5 内核复制与执行</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%A7%BB%E6%A4%8D"><span class="toc-number">3.2.</span> <span class="toc-text">2.文件系统移植</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-Target-options%E9%85%8D%E7%BD%AE"><span class="toc-number">3.2.1.</span> <span class="toc-text">2.1 Target options配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-Build-options%E9%85%8D%E7%BD%AE"><span class="toc-number">3.2.2.</span> <span class="toc-text">2.2 Build options配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-Toolchain%E9%85%8D%E7%BD%AE"><span class="toc-number">3.2.3.</span> <span class="toc-text">2.3 Toolchain配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-System-configuration%E9%85%8D%E7%BD%AE-https-www-cnblogs-com-twzy-p-15355842-html-2-4-system-configuration%E9%85%8D%E7%BD%AE"><span class="toc-number">3.2.4.</span> <span class="toc-text">2.4 System configuration配置[#](https:&#x2F;&#x2F;www.cnblogs.com&#x2F;twzy&#x2F;p&#x2F;15355842.html#2.4 system-configuration配置)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%A7%BB%E6%A4%8D%E4%B8%8E%E6%89%A7%E8%A1%8C"><span class="toc-number">3.2.5.</span> <span class="toc-text">2.5 文件系统移植与执行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-%E5%8D%87%E7%BA%A7%E9%80%BC%E6%A0%BC-https-www-cnblogs-com-twzy-p-15355842-html-2-6-%E5%8D%87%E7%BA%A7%E9%80%BC%E6%A0%BC"><span class="toc-number">3.2.6.</span> <span class="toc-text">2.6 升级逼格[#](https:&#x2F;&#x2F;www.cnblogs.com&#x2F;twzy&#x2F;p&#x2F;15355842.html#2.6 升级逼格)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E7%82%B9%E4%B8%AA%E7%81%AF%E5%90%A7"><span class="toc-number">3.3.</span> <span class="toc-text">3. 点个灯吧</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E9%93%BE%E6%8E%A5%EF%BC%88%E4%BE%B5%E5%88%A0%EF%BC%89"><span class="toc-number">4.</span> <span class="toc-text">相关链接（侵删）</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/3511617639.html" title="Web Serial网页串口"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Web Serial网页串口"/></a><div class="content"><a class="title" href="/posts/3511617639.html" title="Web Serial网页串口">Web Serial网页串口</a><time datetime="2025-09-10T13:03:20.000Z" title="发表于 2025-09-10 21:03:20">2025-09-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/968082855.html" title="全志F1C100s使用记录"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="全志F1C100s使用记录"/></a><div class="content"><a class="title" href="/posts/968082855.html" title="全志F1C100s使用记录">全志F1C100s使用记录</a><time datetime="2025-09-10T11:59:20.000Z" title="发表于 2025-09-10 19:59:20">2025-09-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/2546212267.html" title="ESP8266内置网页配置"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ESP8266内置网页配置"/></a><div class="content"><a class="title" href="/posts/2546212267.html" title="ESP8266内置网页配置">ESP8266内置网页配置</a><time datetime="2025-09-10T08:09:20.000Z" title="发表于 2025-09-10 16:09:20">2025-09-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/2989473239.html" title="自制F1C200S demo板"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="自制F1C200S demo板"/></a><div class="content"><a class="title" href="/posts/2989473239.html" title="自制F1C200S demo板">自制F1C200S demo板</a><time datetime="2025-09-10T07:51:20.000Z" title="发表于 2025-09-10 15:51:20">2025-09-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/931990122.html" title="f1c100sf1c200s 裸机程序"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="f1c100sf1c200s 裸机程序"/></a><div class="content"><a class="title" href="/posts/931990122.html" title="f1c100sf1c200s 裸机程序">f1c100sf1c200s 裸机程序</a><time datetime="2025-09-10T07:45:20.000Z" title="发表于 2025-09-10 15:45:20">2025-09-10</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By ZhaoYichen</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a href="icp连接"><img class="icp-icon" src="icp图片"><span>备案号：xxxxxx</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script></div><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"log":false});</script></body></html>